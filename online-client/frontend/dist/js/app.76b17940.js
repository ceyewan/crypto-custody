(function(){"use strict";var e={959:function(e,t,s){var a=s(5471),r=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],o={name:"App"},n=o,l=s(1656),c=(0,l.A)(n,r,i,!1,null,null,null),d=c.exports,u=s(173),m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container"},[t("el-card",{staticClass:"login-card"},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("h2",[e._v("在线系统登录")])]),t("el-form",{ref:"loginForm",attrs:{model:e.loginForm,rules:e.rules,"label-width":"0px"}},[t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"用户名"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",placeholder:"密码","show-password":""},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.loading},on:{click:e.handleLogin}},[e._v(" 登录 ")])],1),t("el-form-item",[t("div",{staticClass:"register-link"},[t("span",[e._v("没有账号?")]),t("router-link",{attrs:{to:"/register"}},[e._v("立即注册")])],1)])],1)],1)],1)},p=[],h=s(2505),g=s.n(h),f=s(5353);a["default"].use(f.Ay);var w=new f.Ay.Store({state:{token:localStorage.getItem("token")||"",user:JSON.parse(localStorage.getItem("user"))||null,accounts:[],transactions:[]},getters:{isLoggedIn:e=>!!e.token,currentUser:e=>e.user,userRole:e=>e.user?e.user.role:"",isAdmin:e=>e.user&&"admin"===e.user.role,isOfficer:e=>e.user&&("officer"===e.user.role||"admin"===e.user.role),isGuest:e=>e.user&&"guest"===e.user.role,userAccounts:e=>e.accounts,userTransactions:e=>e.transactions},mutations:{setToken(e,t){e.token=t,localStorage.setItem("token",t)},setUser(e,t){e.user=t,localStorage.setItem("user",JSON.stringify(t))},clearToken(e){e.token="",e.user=null,localStorage.removeItem("token"),localStorage.removeItem("user")},setAccounts(e,t){e.accounts=t},addAccount(e,t){e.accounts.push(t)},updateAccount(e,t){const s=e.accounts.findIndex((e=>e.address===t.address));-1!==s&&a["default"].set(e.accounts,s,t)},removeAccount(e,t){e.accounts=e.accounts.filter((e=>e.address!==t))},setTransactions(e,t){e.transactions=t},addTransaction(e,t){e.transactions.unshift(t)}},actions:{login({commit:e},t){e("setToken",t.token),e("setUser",t.user)},logout({commit:e}){e("clearToken"),e("setAccounts",[]),e("setTransactions",[])},updateUserInfo({commit:e},t){e("setUser",t)},loadAccounts({commit:e},t){e("setAccounts",t)},createAccount({commit:e},t){e("addAccount",t)},updateAccountInfo({commit:e},t){e("updateAccount",t)},deleteAccount({commit:e},t){e("removeAccount",t)},loadTransactions({commit:e},t){e("setTransactions",t)},addNewTransaction({commit:e},t){e("addTransaction",t)}}});const v="http://localhost:8080",b=g().create({baseURL:v,timeout:1e4});b.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=t),e}),(e=>(console.error("Request interceptor error:",e),Promise.reject(e)))),b.interceptors.response.use((e=>e),(e=>(e.response?(401===e.response.status&&(console.error("Authentication failed, please login again"),w&&w.dispatch&&(w.dispatch("logout"),"#/login"!==window.location.hash&&setTimeout((()=>{window.location.hash="#/login"}),100))),console.error("API error:",e.response.status,e.response.data)):e.request?console.error("Request timeout or no response:",e.request):console.error("Request configuration error:",e.message),Promise.reject(e))));const y={login(e){return b.post("/api/login",e)},register(e){return b.post("/api/register",e)},checkAuth(e){return b.post("/api/check-auth",{token:e})},getProfile(){return b.get("/api/users/profile")},logout(){return b.post("/api/users/logout")},changePassword(e){return b.post("/api/users/change-password",e)},getUsers(){return b.get("/api/users/admin/users")},getUserById(e){return b.get(`/api/users/admin/users/${e}`)},updateUserRole(e,t){return b.put(`/api/users/admin/users/${e}/role`,{role:t})},updateUsername(e,t){return b.put(`/api/users/admin/users/${e}/username`,{username:t})},adminUpdatePassword(e,t){return b.put(`/api/users/admin/users/${e}/password`,{newPassword:t})},deleteUser(e){return b.delete(`/api/users/admin/users/${e}`)}},_={getAccountByAddress(e){return b.get(`/api/accounts/address/${e}`)},getUserAccounts(){return b.get("/api/accounts/officer/")},createAccount(e){return b.post("/api/accounts/officer/create",e)},importAccounts(e){return b.post("/api/accounts/officer/import",e)},getAllAccounts(){return b.get("/api/accounts/admin/all")},deleteAccount(e){return b.delete(`/api/accounts/admin/${e}`)}},A={getBalance(e){return b.get(`/api/transaction/balance/${e}`)},prepareTransaction(e){return b.post("/api/transaction/tx/prepare",e)},signAndSendTransaction(e){return b.post("/api/transaction/tx/sign-send",e)},getTransactions(e={}){return b.get("/api/transaction/list",{params:e})},getAllTransactions(e={}){return b.get("/api/transaction/admin/all",{params:e})},getTransactionById(e){return b.get(`/api/transaction/${e}`)},getTransactionStats(){return b.get("/api/transaction/stats")},getAllTransactionStats(){return b.get("/api/transaction/admin/stats")},deleteTransaction(e){return b.delete(`/api/transaction/admin/${e}`)}};var T={name:"Login",data(){return{loginForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:!1}},methods:{handleLogin(){this.$refs.loginForm.validate((async e=>{if(!e)return!1;this.loading=!0;try{const e=await y.login({username:this.loginForm.username,password:this.loginForm.password});if(!e.data||200!==e.data.code)throw new Error(e.data?.message||"登录失败");const t=e.data.data;this.$store.dispatch("login",{token:t.token,user:t.user}),console.log("User login successful:",t.user.username,t.user.role),this.$router.push("/dashboard"),this.$message.success("登录成功")}catch(t){console.error("Login failed:",t);let e="登录失败，请检查用户名和密码";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}finally{this.loading=!1}}))}}},C=T,x=(0,l.A)(C,m,p,!1,null,"243bb4ee",null),F=x.exports,$=function(){var e=this,t=e._self._c;return t("div",{staticClass:"register-container"},[t("el-card",{staticClass:"register-card"},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("h2",[e._v("用户注册")])]),t("el-form",{ref:"registerForm",attrs:{model:e.registerForm,rules:e.rules,"label-width":"0px"}},[t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"用户名"},model:{value:e.registerForm.username,callback:function(t){e.$set(e.registerForm,"username",t)},expression:"registerForm.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",placeholder:"密码","show-password":""},model:{value:e.registerForm.password,callback:function(t){e.$set(e.registerForm,"password",t)},expression:"registerForm.password"}})],1),t("el-form-item",{attrs:{prop:"confirmPassword"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",placeholder:"确认密码","show-password":""},model:{value:e.registerForm.confirmPassword,callback:function(t){e.$set(e.registerForm,"confirmPassword",t)},expression:"registerForm.confirmPassword"}})],1),t("el-form-item",{attrs:{prop:"email"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-message",placeholder:"邮箱"},model:{value:e.registerForm.email,callback:function(t){e.$set(e.registerForm,"email",t)},expression:"registerForm.email"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.loading},on:{click:e.handleRegister}},[e._v(" 注册 ")])],1),t("el-form-item",[t("div",{staticClass:"login-link"},[t("span",[e._v("已有账号?")]),t("router-link",{attrs:{to:"/login"}},[e._v("立即登录")])],1)])],1)],1)],1)},k=[],L={name:"Register",data(){const e=(e,t,s)=>{t!==this.registerForm.password?s(new Error("两次输入的密码不一致")):s()};return{registerForm:{username:"",password:"",confirmPassword:"",email:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应为3-20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:e,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},loading:!1}},methods:{handleRegister(){this.$refs.registerForm.validate((async e=>{if(!e)return!1;this.loading=!0;try{const e=await y.register({username:this.registerForm.username,password:this.registerForm.password,email:this.registerForm.email});if(!e.data||200!==e.data.code)throw new Error(e.data?.message||"注册失败");this.$message.success("注册成功，请登录"),this.$router.push("/login")}catch(t){console.error("Registration failed:",t);let e="注册失败，请稍后重试";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}finally{this.loading=!1}}))}}},D=L,S=(0,l.A)(D,$,k,!1,null,"5d71558c",null),P=S.exports,U=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dashboard-container"},[t("el-container",[t("el-header",{staticClass:"header"},[t("div",{staticClass:"logo"},[e._v("在线加密货币托管系统")]),t("div",{staticClass:"user-info"},[t("span",[e._v("欢迎, "+e._s(e.user.username)+" ("+e._s(e.roleText)+")")]),t("el-dropdown",{on:{command:e.handleCommand}},[t("span",{staticClass:"el-dropdown-link"},[t("i",{staticClass:"el-icon-setting"})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"profile"}},[e._v("个人资料")]),t("el-dropdown-item",{attrs:{command:"logout",divided:""}},[e._v("退出登录")])],1)],1)],1)]),t("el-container",[t("el-aside",{attrs:{width:"250px"}},[t("el-menu",{staticClass:"menu",attrs:{"default-active":e.activeMenu,router:"","background-color":"#304156","text-color":"#bfcbd9","active-text-color":"#409EFF"}},[e.isAdmin?t("el-menu-item",{attrs:{index:"/users"}},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v("用户管理")])]):e._e(),e.isOfficer?t("el-menu-item",{attrs:{index:"/accounts"}},[t("i",{staticClass:"el-icon-wallet"}),t("span",[e._v("账户管理")])]):e._e(),e.isOfficer?t("el-menu-item",{attrs:{index:"/transactions"}},[t("i",{staticClass:"el-icon-s-finance"}),t("span",[e._v("交易管理")])]):e._e(),t("el-menu-item",{attrs:{index:"/profile"}},[t("i",{staticClass:"el-icon-user-solid"}),t("span",[e._v("个人资料")])])],1)],1),t("el-main",[t("router-view"),"/dashboard"===e.$route.path?t("div",{staticClass:"welcome-container"},[t("div",{staticClass:"welcome-message"},[t("i",{staticClass:"el-icon-s-home welcome-icon"}),t("h2",[e._v("欢迎使用在线加密货币托管系统")]),t("p",[e._v("请根据您的角色和需求，使用左侧菜单选择相应功能")]),t("div",{staticClass:"stats-container"},[t("el-row",{attrs:{gutter:20}},[e.isOfficer?t("el-col",{attrs:{span:8}},[t("el-card",{staticClass:"stat-card"},[t("div",{staticClass:"stat-content"},[t("div",{staticClass:"stat-number"},[e._v(e._s(e.accountCount))]),t("div",{staticClass:"stat-label"},[e._v("管理账户数")])]),t("i",{staticClass:"el-icon-wallet stat-icon"})])],1):e._e(),e.isOfficer?t("el-col",{attrs:{span:8}},[t("el-card",{staticClass:"stat-card"},[t("div",{staticClass:"stat-content"},[t("div",{staticClass:"stat-number"},[e._v(e._s(e.transactionCount))]),t("div",{staticClass:"stat-label"},[e._v("交易次数")])]),t("i",{staticClass:"el-icon-s-finance stat-icon"})])],1):e._e(),e.isAdmin?t("el-col",{attrs:{span:8}},[t("el-card",{staticClass:"stat-card"},[t("div",{staticClass:"stat-content"},[t("div",{staticClass:"stat-number"},[e._v(e._s(e.userCount))]),t("div",{staticClass:"stat-label"},[e._v("系统用户数")])]),t("i",{staticClass:"el-icon-user stat-icon"})])],1):e._e()],1)],1),e.isAdmin?t("div",{staticClass:"feature-box"},[t("h3",[e._v("管理员功能")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/users")}}},[e._v("用户管理")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/accounts")}}},[e._v("账户管理")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/transactions")}}},[e._v("交易管理")])],1):e.isOfficer?t("div",{staticClass:"feature-box"},[t("h3",[e._v("警员功能")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/accounts")}}},[e._v("账户管理")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/transactions")}}},[e._v("交易管理")])],1):t("div",{staticClass:"feature-box"},[t("h3",[e._v("访客功能")]),t("p",[e._v("您当前是访客身份，权限有限")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/profile")}}},[e._v("查看个人资料")])],1)])]):e._e()],1)],1)],1)],1)},R=[],B={name:"Dashboard",data(){return{activeMenu:this.$route.path,accountCount:0,transactionCount:0,userCount:0}},computed:{...(0,f.L8)(["currentUser","isAdmin","isOfficer","isGuest"]),user(){return this.currentUser||{}},roleText(){return this.isAdmin?"管理员":this.isOfficer?"警员":"访客"}},created(){this.loadDashboardStats()},methods:{async loadDashboardStats(){try{if(this.isOfficer){const e=await _.getUserAccounts();200===e.data.code&&(this.accountCount=e.data.data.length)}if(this.isAdmin){const e=await y.getUsers();200===e.data.code&&(this.userCount=e.data.data.length)}if(this.isOfficer)try{let e;e=this.isAdmin?await A.getAllTransactionStats():await A.getTransactionStats(),200===e.data.code&&(this.transactionCount=e.data.data.count||0)}catch(e){console.error("Failed to load transaction stats:",e),this.transactionCount=0}}catch(e){console.error("Failed to load dashboard stats:",e)}},handleCommand(e){switch(e){case"profile":this.$router.push("/profile");break;case"logout":this.handleLogout();break}},async handleLogout(){try{await y.logout()}catch(e){console.error("Logout API failed:",e)}finally{this.$store.dispatch("logout"),this.$router.push("/login"),this.$message.success("已退出登录")}}},watch:{"$route.path"(e){this.activeMenu=e}}},I=B,V=(0,l.A)(I,U,R,!1,null,"1d08eefd",null),E=V.exports,O=function(){var e=this,t=e._self._c;return t("div",{staticClass:"users-container"},[t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("用户管理")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.refreshUserList}},[e._v(" 刷新 ")])],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.userList}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t("el-table-column",{attrs:{prop:"username",label:"用户名",width:"150"}}),t("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"200"}}),t("el-table-column",{attrs:{prop:"role",label:"当前角色",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getRoleTagType(s.row.role)}},[e._v(e._s(e.getRoleText(s.row.role)))])]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"选择角色",size:"small"},model:{value:s.row.newRole,callback:function(t){e.$set(s.row,"newRole",t)},expression:"scope.row.newRole"}},[t("el-option",{attrs:{label:"管理员",value:"admin"}}),t("el-option",{attrs:{label:"警员",value:"officer"}}),t("el-option",{attrs:{label:"访客",value:"guest"}})],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small",disabled:s.row.role===s.row.newRole},on:{click:function(t){return e.updateUserRole(s.row)}}},[e._v(" 更新角色 ")]),t("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"warning",size:"small"},on:{click:function(t){return e.showEditUserDialog(s.row)}}},[e._v(" 编辑 ")]),t("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"danger",size:"small"},on:{click:function(t){return e.deleteUser(s.row)}}},[e._v(" 删除 ")])]}}])})],1),0!==e.userList.length||e.loading?e._e():t("div",{staticClass:"empty-state"},[t("p",[e._v("暂无用户数据")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.refreshUserList}},[e._v("刷新")])],1)],1),t("el-dialog",{attrs:{title:"编辑用户",visible:e.editDialogVisible,width:"400px"},on:{"update:visible":function(t){e.editDialogVisible=t}}},[t("el-form",{ref:"editForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"用户名",prop:"username"}},[t("el-input",{model:{value:e.editForm.username,callback:function(t){e.$set(e.editForm,"username",t)},expression:"editForm.username"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[t("el-input",{attrs:{type:"password",placeholder:"留空则不修改密码"},model:{value:e.editForm.newPassword,callback:function(t){e.$set(e.editForm,"newPassword",t)},expression:"editForm.newPassword"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.editDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.editLoading},on:{click:e.handleEditUser}},[e._v("确 定")])],1)],1)],1)},q=[],z={name:"Users",data(){return{userList:[],loading:!1,editDialogVisible:!1,editLoading:!1,editForm:{id:null,username:"",newPassword:""},editRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应为3-20个字符",trigger:"blur"}],newPassword:[{min:6,message:"密码长度至少为6个字符",trigger:"blur"}]}}},created(){this.fetchUserList()},methods:{async fetchUserList(){this.loading=!0;try{const e=await y.getUsers();if(200!==e.data.code)throw new Error(e.data.message||"获取用户列表失败");this.userList=e.data.data.map((e=>({...e,newRole:e.role}))),0===this.userList.length&&this.$message.warning("未找到用户数据")}catch(e){console.error("获取用户列表失败:",e);let t="获取用户列表失败";e.response&&e.response.data?t=e.response.data.message||t:e.message&&(t=e.message),this.$message.error(t)}finally{this.loading=!1}},async updateUserRole(e){try{const t=await y.updateUserRole(e.id,e.newRole);if(200!==t.data.code)throw new Error(t.data.message||"更新角色失败");this.$message.success(`用户 ${e.username} 角色已更新为 ${this.getRoleText(e.newRole)}`),e.role=e.newRole}catch(t){console.error("更新用户角色失败:",t);let s="更新用户角色失败";t.response&&t.response.data&&(s=t.response.data.message||s),this.$message.error(s),e.newRole=e.role}},showEditUserDialog(e){this.editForm={id:e.id,username:e.username,newPassword:""},this.editDialogVisible=!0},async handleEditUser(){this.$refs.editForm.validate((async e=>{if(!e)return!1;this.editLoading=!0;try{const e=await y.updateUsername(this.editForm.id,this.editForm.username);if(200!==e.data.code)throw new Error(e.data.message||"更新用户名失败");if(this.editForm.newPassword){const e=await y.adminUpdatePassword(this.editForm.id,this.editForm.newPassword);if(200!==e.data.code)throw new Error(e.data.message||"更新密码失败")}this.$message.success("用户信息更新成功"),this.editDialogVisible=!1,this.fetchUserList()}catch(t){console.error("更新用户信息失败:",t);let e="更新用户信息失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}finally{this.editLoading=!1}}))},async deleteUser(e){try{const t=await this.$confirm(`确定要删除用户 "${e.username}" 吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});if(t){const t=await y.deleteUser(e.id);if(200!==t.data.code)throw new Error(t.data.message||"删除用户失败");this.$message.success("用户删除成功"),this.fetchUserList()}}catch(t){if("cancel"!==t){console.error("删除用户失败:",t);let e="删除用户失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}}},refreshUserList(){this.fetchUserList()},getRoleText(e){const t={admin:"管理员",officer:"警员",guest:"访客"};return t[e]||e},getRoleTagType(e){const t={admin:"danger",officer:"warning",guest:"info"};return t[e]||"info"}}},H=z,j=(0,l.A)(H,O,q,!1,null,"c0d7e3e6",null),N=j.exports,M=function(){var e=this,t=e._self._c;return t("div",{staticClass:"accounts-container"},[t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("账户管理")]),t("div",{staticStyle:{float:"right"}},[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.showCreateDialog}},[e._v(" 创建账户 ")]),t("el-button",{attrs:{type:"success",size:"small"},on:{click:e.showImportDialog}},[e._v(" 批量导入 ")]),t("el-button",{attrs:{type:"text"},on:{click:e.refreshAccountList}},[e._v(" 刷新 ")])],1)]),t("div",{staticClass:"search-area"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("el-input",{attrs:{placeholder:"搜索账户地址",clearable:""},model:{value:e.searchAddress,callback:function(t){e.searchAddress=t},expression:"searchAddress"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchAccount},slot:"append"})],1)],1),t("el-col",{attrs:{span:4}},[t("el-select",{attrs:{placeholder:"币种筛选",clearable:""},on:{change:e.handleFilter},model:{value:e.filterCoinType,callback:function(t){e.filterCoinType=t},expression:"filterCoinType"}},[t("el-option",{attrs:{label:"ETH",value:"ETH"}}),t("el-option",{attrs:{label:"BTC",value:"BTC"}}),t("el-option",{attrs:{label:"USDT",value:"USDT"}})],1)],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.filteredAccountList}},[t("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t("el-table-column",{attrs:{prop:"address",label:"地址",width:"280"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{attrs:{title:s.row.address}},[e._v(e._s(e.formatAddress(s.row.address)))]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.copyAddress(s.row.address)}}},[e._v("复制")])]}}])}),t("el-table-column",{attrs:{prop:"coinType",label:"币种",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getCoinTypeTagType(s.row.coinType)}},[e._v(e._s(s.row.coinType))])]}}])}),t("el-table-column",{attrs:{prop:"balance",label:"余额",width:"150"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",[e._v(e._s(s.row.balance||"0")+" "+e._s(s.row.coinType))]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.refreshBalance(s.row)}}},[e._v("刷新")])]}}])}),t("el-table-column",{attrs:{prop:"importedBy",label:"导入者",width:"120"}}),t("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":""}}),t("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.viewAccountDetail(s.row)}}},[e._v(" 详情 ")]),t("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.deleteAccount(s.row)}}},[e._v(" 删除 ")])]}}])})],1),0!==e.filteredAccountList.length||e.loading?e._e():t("div",{staticClass:"empty-state"},[t("p",[e._v("暂无账户数据")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.showCreateDialog}},[e._v("创建账户")])],1)],1),t("el-dialog",{attrs:{title:"创建账户",visible:e.createDialogVisible,width:"500px"},on:{"update:visible":function(t){e.createDialogVisible=t}}},[t("el-form",{ref:"createForm",attrs:{model:e.createForm,rules:e.createRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"账户地址",prop:"address"}},[t("el-input",{attrs:{placeholder:"请输入账户地址"},model:{value:e.createForm.address,callback:function(t){e.$set(e.createForm,"address",t)},expression:"createForm.address"}})],1),t("el-form-item",{attrs:{label:"币种类型",prop:"coinType"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择币种"},model:{value:e.createForm.coinType,callback:function(t){e.$set(e.createForm,"coinType",t)},expression:"createForm.coinType"}},[t("el-option",{attrs:{label:"ETH",value:"ETH"}}),t("el-option",{attrs:{label:"BTC",value:"BTC"}}),t("el-option",{attrs:{label:"USDT",value:"USDT"}})],1)],1),t("el-form-item",{attrs:{label:"描述信息",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入描述信息（可选）"},model:{value:e.createForm.description,callback:function(t){e.$set(e.createForm,"description",t)},expression:"createForm.description"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.createDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.createLoading},on:{click:e.handleCreateAccount}},[e._v("确 定")])],1)],1),t("el-dialog",{attrs:{title:"批量导入账户",visible:e.importDialogVisible,width:"600px"},on:{"update:visible":function(t){e.importDialogVisible=t}}},[t("div",{staticClass:"import-area"},[t("p",[e._v("请按以下格式输入账户信息（每行一个账户）：")]),t("p",[t("strong",[e._v("格式：地址,币种,描述")])]),t("p",{staticClass:"example"},[e._v("例如：0x1234567890abcdef...,ETH,主账户")]),t("el-input",{attrs:{type:"textarea",rows:8,placeholder:"地址1,币种1,描述1&#10;地址2,币种2,描述2&#10;..."},model:{value:e.importText,callback:function(t){e.importText=t},expression:"importText"}})],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.importDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.importLoading},on:{click:e.handleImportAccounts}},[e._v("导 入")])],1)]),t("el-dialog",{attrs:{title:"账户详情",visible:e.detailDialogVisible,width:"500px"},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[e.selectedAccount?t("div",{staticClass:"account-detail"},[t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"地址"}},[t("span",[e._v(e._s(e.selectedAccount.address))]),t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.copyAddress(e.selectedAccount.address)}}},[e._v("复制")])],1),t("el-descriptions-item",{attrs:{label:"币种"}},[t("el-tag",{attrs:{type:e.getCoinTypeTagType(e.selectedAccount.coinType)}},[e._v(e._s(e.selectedAccount.coinType))])],1),t("el-descriptions-item",{attrs:{label:"余额"}},[e._v(" "+e._s(e.selectedAccount.balance||"0")+" "+e._s(e.selectedAccount.coinType)+" ")]),t("el-descriptions-item",{attrs:{label:"导入者"}},[e._v(e._s(e.selectedAccount.importedBy))]),t("el-descriptions-item",{attrs:{label:"描述"}},[e._v(e._s(e.selectedAccount.description||"无"))])],1)],1):e._e()])],1)},G=[],J={name:"Accounts",data(){return{accountList:[],filteredAccountList:[],loading:!1,searchAddress:"",filterCoinType:"",createDialogVisible:!1,importDialogVisible:!1,detailDialogVisible:!1,createLoading:!1,importLoading:!1,selectedAccount:null,importText:"",createForm:{address:"",coinType:"",description:""},createRules:{address:[{required:!0,message:"请输入账户地址",trigger:"blur"},{min:10,message:"地址长度不能少于10个字符",trigger:"blur"}],coinType:[{required:!0,message:"请选择币种类型",trigger:"change"}]}}},created(){this.fetchAccountList()},methods:{async fetchAccountList(){this.loading=!0;try{let e;if(e=this.$store.getters.isAdmin?await _.getAllAccounts():await _.getUserAccounts(),200!==e.data.code)throw new Error(e.data.message||"获取账户列表失败");{const t=e.data.data;let s=[];s=Array.isArray(t)?t:t&&Array.isArray(t.accounts)?t.accounts:[],this.accountList=s.map((e=>({id:e.ID,address:e.Address,coinType:e.CoinType,balance:e.Balance,importedBy:e.ImportedBy,description:e.Description,createdAt:e.CreatedAt,updatedAt:e.UpdatedAt}))),this.filteredAccountList=[...this.accountList]}}catch(e){console.error("获取账户列表失败:",e);let t="获取账户列表失败";e.response&&e.response.data?t=e.response.data.message||t:e.message&&(t=e.message),this.$message.error(t)}finally{this.loading=!1}},searchAccount(){this.searchAddress.trim()?this.searchAccountByAddress(this.searchAddress.trim()):this.applyFilters()},async searchAccountByAddress(e){try{const t=await _.getAccountByAddress(e);if(200===t.data.code){const e=t.data.data,s={id:e.ID,address:e.Address,coinType:e.CoinType,balance:e.Balance,importedBy:e.ImportedBy,description:e.Description,createdAt:e.CreatedAt,updatedAt:e.UpdatedAt};this.filteredAccountList=[s],this.$message.success("找到匹配的账户")}else this.$message.warning("未找到该地址的账户"),this.filteredAccountList=[]}catch(t){console.error("搜索账户失败:",t),this.$message.error("搜索账户失败"),this.applyFilters()}},handleFilter(){this.applyFilters()},applyFilters(){let e=[...this.accountList];if(this.filterCoinType&&(e=e.filter((e=>e.coinType===this.filterCoinType))),this.searchAddress.trim()){const t=this.searchAddress.trim().toLowerCase();e=e.filter((e=>e.address.toLowerCase().includes(t)))}this.filteredAccountList=e},showCreateDialog(){this.createForm={address:"",coinType:"",description:""},this.createDialogVisible=!0},async handleCreateAccount(){this.$refs.createForm.validate((async e=>{if(!e)return!1;this.createLoading=!0;try{const e=await _.createAccount({address:this.createForm.address,coinType:this.createForm.coinType,description:this.createForm.description});if(200!==e.data.code)throw new Error(e.data.message||"创建账户失败");this.$message.success("账户创建成功"),this.createDialogVisible=!1,this.fetchAccountList()}catch(t){console.error("创建账户失败:",t);let e="创建账户失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}finally{this.createLoading=!1}}))},showImportDialog(){this.importText="",this.importDialogVisible=!0},async handleImportAccounts(){if(this.importText.trim()){this.importLoading=!0;try{const e=this.importText.trim().split("\n"),t=[];for(const a of e){const e=a.split(",").map((e=>e.trim()));e.length>=2&&t.push({address:e[0],coinType:e[1],description:e[2]||""})}if(0===t.length)return void this.$message.warning("没有有效的账户信息");const s=await _.importAccounts({accounts:t});if(200!==s.data.code)throw new Error(s.data.message||"批量导入失败");this.$message.success(`成功导入 ${t.length} 个账户`),this.importDialogVisible=!1,this.fetchAccountList()}catch(e){console.error("批量导入失败:",e);let t="批量导入失败";e.response&&e.response.data?t=e.response.data.message||t:e.message&&(t=e.message),this.$message.error(t)}finally{this.importLoading=!1}}else this.$message.warning("请输入要导入的账户信息")},async refreshBalance(e){try{const t=await A.getBalance(e.address);if(200===t.data.code){const s=this.accountList.findIndex((t=>t.address===e.address));-1!==s&&(this.$set(this.accountList[s],"balance",t.data.data.balance),this.applyFilters()),this.$message.success("余额已刷新")}}catch(t){console.error("刷新余额失败:",t),this.$message.error("刷新余额失败")}},viewAccountDetail(e){this.selectedAccount=e,this.detailDialogVisible=!0},copyAddress(e){navigator.clipboard?navigator.clipboard.writeText(e).then((()=>{this.$message.success("地址已复制到剪贴板")})).catch((()=>{this.fallbackCopyTextToClipboard(e)})):this.fallbackCopyTextToClipboard(e)},fallbackCopyTextToClipboard(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.$message.success("地址已复制到剪贴板")}catch(s){this.$message.error("复制失败，请手动复制")}document.body.removeChild(t)},async deleteAccount(e){try{const t=await this.$confirm(`确定要删除账户 "${this.formatAddress(e.address)}" 吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});if(t){const t=await _.deleteAccount(e.id);if(200!==t.data.code)throw new Error(t.data.message||"删除账户失败");this.$message.success("账户删除成功"),this.fetchAccountList()}}catch(t){if("cancel"!==t){console.error("删除账户失败:",t);let e="删除账户失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}}},refreshAccountList(){this.searchAddress="",this.filterCoinType="",this.fetchAccountList()},formatAddress(e){return!e||e.length<=20?e:`${e.slice(0,10)}...${e.slice(-8)}`},getCoinTypeTagType(e){const t={ETH:"primary",BTC:"warning",USDT:"success"};return t[e]||"info"}},watch:{searchAddress(){this.searchAddress.trim()||this.applyFilters()}}},K=J,Q=(0,l.A)(K,M,G,!1,null,"6e67dcb4",null),W=Q.exports,X=function(){var e=this,t=e._self._c;return t("div",{staticClass:"transactions-container"},[t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("交易管理")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.fetchTransactions}},[e._v(" 刷新 ")])],1),t("div",{staticClass:"action-area"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:18}},[t("span",{staticClass:"transaction-summary"},[e._v("共 "+e._s(e.transactionList.length)+" 笔交易")])]),t("el-col",{staticStyle:{"text-align":"right"},attrs:{span:6}},[t("el-button",{attrs:{type:"primary"},on:{click:e.showCreateTransactionDialog}},[t("i",{staticClass:"el-icon-plus"}),e._v(" 发起交易 ")])],1)],1)],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.transactionList}},[t("el-table-column",{attrs:{prop:"id",label:"交易ID",width:"80"}}),t("el-table-column",{attrs:{prop:"fromAddress",label:"发送方",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{attrs:{title:s.row.fromAddress}},[e._v(e._s(e.formatAddress(s.row.fromAddress)))])]}}])}),t("el-table-column",{attrs:{prop:"toAddress",label:"接收方",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("span",{attrs:{title:s.row.toAddress}},[e._v(e._s(e.formatAddress(s.row.toAddress)))])]}}])}),t("el-table-column",{attrs:{prop:"amount",label:"金额",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.amount)+" ")]}}])}),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getStatusTagType(s.row.status)}},[e._v(e._s(e.getStatusText(s.row.status)))])]}}])}),t("el-table-column",{attrs:{prop:"txHash",label:"交易哈希",width:"200"},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.txHash?t("span",{attrs:{title:s.row.txHash}},[e._v(e._s(e.formatAddress(s.row.txHash)))]):t("span",[e._v("-")])]}}])}),t("el-table-column",{attrs:{prop:"createdAt",label:"创建时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.formatDateTime(t.row.createdAt))+" ")]}}])}),t("el-table-column",{attrs:{label:"操作",width:"220"},scopedSlots:e._u([{key:"default",fn:function(s){return["prepared"===s.row.status?t("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.signTransaction(s.row)}}},[e._v(" 操作 ")]):e._e(),t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.viewTransactionDetail(s.row)}}},[e._v(" 详情 ")]),t("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.deleteTransaction(s.row)}}},[e._v(" 删除 ")])]}}])})],1),0!==e.transactionList.length||e.loading?e._e():t("div",{staticClass:"empty-state"},[t("p",[e._v("暂无交易记录")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.showCreateTransactionDialog}},[e._v("发起交易")])],1)],1),t("el-dialog",{attrs:{title:"发起交易",visible:e.createDialogVisible,width:"500px"},on:{"update:visible":function(t){e.createDialogVisible=t}}},[t("el-form",{ref:"createForm",attrs:{model:e.createForm,rules:e.createRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"发送方地址",prop:"fromAddress"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择发送方地址"},model:{value:e.createForm.fromAddress,callback:function(t){e.$set(e.createForm,"fromAddress",t)},expression:"createForm.fromAddress"}},e._l(e.userAccounts,(function(s){return t("el-option",{key:s.address,attrs:{label:s.address,value:s.address}},[t("span",[e._v(e._s(e.formatAddress(s.address)))]),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(s.balance||"0")+" "+e._s(s.coinType))])])})),1)],1),t("el-form-item",{attrs:{label:"当前余额"}},[e.selectedAccountBalance?t("span",[e._v(e._s(e.selectedAccountBalance)+" ETH")]):t("span",[e._v("请选择发送方地址")]),e.createForm.fromAddress?t("el-button",{attrs:{type:"text",size:"mini"},on:{click:e.refreshSelectedBalance}},[e._v("刷新")]):e._e()],1),t("el-form-item",{attrs:{label:"接收方地址",prop:"toAddress"}},[t("el-input",{attrs:{placeholder:"请输入接收方地址"},model:{value:e.createForm.toAddress,callback:function(t){e.$set(e.createForm,"toAddress",t)},expression:"createForm.toAddress"}})],1),t("el-form-item",{attrs:{label:"转账金额",prop:"amount"}},[t("el-input-number",{staticStyle:{width:"100%"},attrs:{precision:6,step:.001,min:.001},model:{value:e.createForm.amount,callback:function(t){e.$set(e.createForm,"amount",t)},expression:"createForm.amount"}}),t("span",{staticStyle:{"margin-left":"10px"}},[e._v("ETH")])],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.createDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.createLoading},on:{click:e.handleCreateTransaction}},[e._v("准备交易")])],1)],1),t("el-dialog",{attrs:{title:"签名并发送交易",visible:e.signDialogVisible,width:"500px"},on:{"update:visible":function(t){e.signDialogVisible=t}}},[e.selectedTransaction?t("div",{staticClass:"sign-transaction"},[t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"交易ID"}},[e._v(e._s(e.selectedTransaction.id))]),t("el-descriptions-item",{attrs:{label:"发送方"}},[e._v(e._s(e.selectedTransaction.fromAddress))]),t("el-descriptions-item",{attrs:{label:"接收方"}},[e._v(e._s(e.selectedTransaction.toAddress))]),t("el-descriptions-item",{attrs:{label:"金额"}},[e._v(e._s(e.selectedTransaction.amount)+" ETH")]),t("el-descriptions-item",{attrs:{label:"消息哈希"}},[e._v(e._s(e.selectedTransaction.messageHash))])],1),t("el-form",{ref:"signForm",staticStyle:{"margin-top":"20px"},attrs:{model:e.signForm,rules:e.signRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"签名数据",prop:"signature"}},[t("el-input",{attrs:{type:"textarea",rows:3,placeholder:"请输入签名数据"},model:{value:e.signForm.signature,callback:function(t){e.$set(e.signForm,"signature",t)},expression:"signForm.signature"}})],1)],1)],1):e._e(),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.signDialogVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary",loading:e.signLoading},on:{click:e.handleSignTransaction}},[e._v("签名发送")])],1)]),t("el-dialog",{attrs:{title:"交易详情",visible:e.detailDialogVisible,width:"600px"},on:{"update:visible":function(t){e.detailDialogVisible=t}}},[e.selectedTransaction?t("div",{staticClass:"transaction-detail"},[t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"交易ID"}},[e._v(e._s(e.selectedTransaction.id))]),t("el-descriptions-item",{attrs:{label:"发送方地址"}},[t("div",{staticClass:"address-row"},[t("span",{staticClass:"address-text"},[e._v(e._s(e.selectedTransaction.fromAddress))]),t("div",{staticClass:"address-actions"},[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.copyText(e.selectedTransaction.fromAddress)}}},[t("i",{staticClass:"el-icon-document-copy"}),e._v(" 复制 ")])],1)])]),t("el-descriptions-item",{attrs:{label:"接收方地址"}},[t("div",{staticClass:"address-row"},[t("span",{staticClass:"address-text"},[e._v(e._s(e.selectedTransaction.toAddress))]),t("div",{staticClass:"address-actions"},[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.copyText(e.selectedTransaction.toAddress)}}},[t("i",{staticClass:"el-icon-document-copy"}),e._v(" 复制 ")])],1)])]),t("el-descriptions-item",{attrs:{label:"转账金额"}},[e._v(e._s(e.selectedTransaction.amount))]),t("el-descriptions-item",{attrs:{label:"状态"}},[t("el-tag",{attrs:{type:e.getStatusTagType(e.selectedTransaction.status)}},[e._v(e._s(e.getStatusText(e.selectedTransaction.status)))])],1),e.selectedTransaction.messageHash?t("el-descriptions-item",{attrs:{label:"消息哈希"}},[t("div",{staticClass:"hash-row"},[t("span",{staticClass:"hash-text"},[e._v(e._s(e.selectedTransaction.messageHash))]),t("div",{staticClass:"hash-actions"},[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.copyText(e.selectedTransaction.messageHash)}}},[t("i",{staticClass:"el-icon-document-copy"}),e._v(" 复制 ")])],1)])]):e._e(),e.selectedTransaction.txHash?t("el-descriptions-item",{attrs:{label:"交易哈希"}},[t("div",{staticClass:"hash-row"},[t("span",{staticClass:"hash-text"},[e._v(e._s(e.selectedTransaction.txHash))]),t("div",{staticClass:"hash-actions"},[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.copyText(e.selectedTransaction.txHash)}}},[t("i",{staticClass:"el-icon-document-copy"}),e._v(" 复制 ")])],1)])]):e._e(),t("el-descriptions-item",{attrs:{label:"创建时间"}},[e._v(e._s(e.formatDateTime(e.selectedTransaction.createdAt)))]),e.selectedTransaction.updatedAt?t("el-descriptions-item",{attrs:{label:"更新时间"}},[e._v(e._s(e.formatDateTime(e.selectedTransaction.updatedAt)))]):e._e()],1),t("div",{staticClass:"detail-actions"},[t("el-button",{attrs:{type:"primary"},on:{click:e.downloadTransactionInfo}},[t("i",{staticClass:"el-icon-download"}),e._v(" 下载交易信息 ")]),t("el-button",{on:{click:e.copyAllTransactionInfo}},[t("i",{staticClass:"el-icon-document-copy"}),e._v(" 复制全部信息 ")])],1)],1):e._e()])],1)},Y=[],Z={name:"Transactions",data(){return{transactionList:[],userAccounts:[],loading:!1,searchFromAddress:"",searchToAddress:"",statusFilter:"",createDialogVisible:!1,signDialogVisible:!1,detailDialogVisible:!1,createLoading:!1,signLoading:!1,selectedTransaction:null,selectedAccountBalance:"",createForm:{fromAddress:"",toAddress:"",amount:null},createRules:{fromAddress:[{required:!0,message:"请选择发送方地址",trigger:"change"}],toAddress:[{required:!0,message:"请输入接收方地址",trigger:"blur"},{min:10,message:"地址长度不能少于10个字符",trigger:"blur"}],amount:[{required:!0,message:"请输入转账金额",trigger:"blur"},{type:"number",min:1e-6,message:"转账金额必须大于0",trigger:"blur"}]},signForm:{signature:""},signRules:{signature:[{required:!0,message:"请输入签名数据",trigger:"blur"}]}}},created(){this.fetchUserAccounts(),this.fetchTransactions()},methods:{async fetchUserAccounts(){try{let e;if(e=this.$store.getters.isAdmin?await _.getAllAccounts():await _.getUserAccounts(),200===e.data.code){const t=e.data.data;let s=[];s=Array.isArray(t)?t:t&&Array.isArray(t.accounts)?t.accounts:[],this.userAccounts=s.map((e=>({id:e.ID,address:e.Address,coinType:e.CoinType,balance:e.Balance,importedBy:e.ImportedBy,description:e.Description,createdAt:e.CreatedAt,updatedAt:e.UpdatedAt})))}}catch(e){console.error("获取账户列表失败:",e)}},async fetchTransactions(){this.loading=!0;try{const e={};let t;if(this.searchFromAddress.trim()&&(e.fromAddress=this.searchFromAddress.trim()),this.searchToAddress.trim()&&(e.toAddress=this.searchToAddress.trim()),this.statusFilter&&(e.status=this.statusFilter),t=this.$store.getters.isAdmin?await A.getAllTransactions(e):await A.getTransactions(e),200!==t.data.code)throw new Error(t.data.message||"获取交易列表失败");this.transactionList=t.data.data.transactions||t.data.data||[]}catch(e){console.error("获取交易列表失败:",e);let t="获取交易列表失败";e.response&&e.response.data?t=e.response.data.message||t:e.message&&(t=e.message),this.$message.error(t),this.transactionList=[]}finally{this.loading=!1}},searchTransactions(){this.fetchTransactions()},resetSearch(){this.searchFromAddress="",this.searchToAddress="",this.statusFilter="",this.fetchTransactions()},showCreateTransactionDialog(){this.createForm={fromAddress:"",toAddress:"",amount:null},this.selectedAccountBalance="",this.createDialogVisible=!0},async handleCreateTransaction(){this.$refs.createForm.validate((async e=>{if(!e)return!1;this.createLoading=!0;try{const e=await A.prepareTransaction({fromAddress:this.createForm.fromAddress,toAddress:this.createForm.toAddress,amount:this.createForm.amount});if(200!==e.data.code)throw new Error(e.data.message||"准备交易失败");this.$message.success("交易准备成功"),this.createDialogVisible=!1,this.fetchTransactions()}catch(t){console.error("准备交易失败:",t);let e="准备交易失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}finally{this.createLoading=!1}}))},signTransaction(e){this.selectedTransaction=e,this.signForm.signature="",this.signDialogVisible=!0},async handleSignTransaction(){this.$refs.signForm.validate((async e=>{if(!e)return!1;this.signLoading=!0;try{const e=await A.signAndSendTransaction({messageHash:this.selectedTransaction.messageHash,signature:this.signForm.signature});if(200!==e.data.code)throw new Error(e.data.message||"交易签名失败");this.$message.success("交易签名并发送成功"),this.signDialogVisible=!1,this.fetchTransactions()}catch(t){console.error("交易签名失败:",t);let e="交易签名失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}finally{this.signLoading=!1}}))},viewTransactionDetail(e){this.selectedTransaction=e,this.detailDialogVisible=!0},async refreshSelectedBalance(){if(this.createForm.fromAddress)try{const e=await A.getBalance(this.createForm.fromAddress);200===e.data.code&&(this.selectedAccountBalance=e.data.data.balance)}catch(e){console.error("获取余额失败:",e),this.$message.error("获取余额失败")}},copyText(e){navigator.clipboard?navigator.clipboard.writeText(e).then((()=>{this.$message.success("已复制到剪贴板")})).catch((()=>{this.fallbackCopyTextToClipboard(e)})):this.fallbackCopyTextToClipboard(e)},fallbackCopyTextToClipboard(e){const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),this.$message.success("已复制到剪贴板")}catch(s){this.$message.error("复制失败，请手动复制")}document.body.removeChild(t)},formatAddress(e){return!e||e.length<=20?e:`${e.slice(0,10)}...${e.slice(-8)}`},formatDateTime(e){return e?new Date(e).toLocaleString("zh-CN"):"-"},getStatusText(e){const t={prepared:"准备中",signed:"已签名",sent:"已发送",confirmed:"已确认",failed:"失败"};return t[e]||e},getStatusTagType(e){const t={prepared:"warning",signed:"primary",sent:"info",confirmed:"success",failed:"danger"};return t[e]||"info"},copyAllTransactionInfo(){if(!this.selectedTransaction)return;const e=this.formatTransactionInfo(this.selectedTransaction);this.copyText(e)},downloadTransactionInfo(){if(!this.selectedTransaction)return;const e=this.formatTransactionInfo(this.selectedTransaction),t=`transaction_${this.selectedTransaction.id}_${(new Date).getTime()}.txt`,s=new Blob([e],{type:"text/plain;charset=utf-8"}),a=window.URL.createObjectURL(s),r=document.createElement("a");r.href=a,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(a),this.$message.success("交易信息已下载")},async deleteTransaction(e){try{const t=await this.$confirm(`确定要删除交易 ID "${e.id}" 吗？此操作不可撤销。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});if(t){const t=await A.deleteTransaction(e.id);if(200!==t.data.code)throw new Error(t.data.message||"删除交易失败");this.$message.success("交易删除成功"),this.fetchTransactions()}}catch(t){if("cancel"!==t){console.error("删除交易失败:",t);let e="删除交易失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}}},formatTransactionInfo(e){let t="交易详情信息\n";return t+="================\n\n",t+=`交易ID: ${e.id}\n`,t+=`发送方地址: ${e.fromAddress}\n`,t+=`接收方地址: ${e.toAddress}\n`,t+=`转账金额: ${e.amount}\n`,t+=`状态: ${this.getStatusText(e.status)}\n`,e.messageHash&&(t+=`消息哈希: ${e.messageHash}\n`),e.txHash&&(t+=`交易哈希: ${e.txHash}\n`),t+=`创建时间: ${this.formatDateTime(e.createdAt)}\n`,e.updatedAt&&(t+=`更新时间: ${this.formatDateTime(e.updatedAt)}\n`),t+="\n生成时间: "+(new Date).toLocaleString("zh-CN"),t}},watch:{"createForm.fromAddress"(){this.refreshSelectedBalance()}}},ee=Z,te=(0,l.A)(ee,X,Y,!1,null,"749d19fe",null),se=te.exports,ae=function(){var e=this,t=e._self._c;return t("div",{staticClass:"profile-container"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("个人资料")])]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:12}},[t("el-card",{staticClass:"profile-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("基本信息")])]),t("el-descriptions",{attrs:{column:1,border:""}},[t("el-descriptions-item",{attrs:{label:"用户ID"}},[e._v(e._s(e.user.id))]),t("el-descriptions-item",{attrs:{label:"用户名"}},[e._v(e._s(e.user.username))]),t("el-descriptions-item",{attrs:{label:"邮箱"}},[e._v(e._s(e.user.email))]),t("el-descriptions-item",{attrs:{label:"角色"}},[t("el-tag",{attrs:{type:e.getRoleTagType(e.user.role)}},[e._v(e._s(e.getRoleText(e.user.role)))])],1)],1)],1)],1),t("el-col",{attrs:{span:12}},[t("el-card",{staticClass:"password-card"},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("修改密码")])]),t("el-form",{ref:"passwordForm",attrs:{model:e.passwordForm,rules:e.passwordRules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"当前密码",prop:"oldPassword"}},[t("el-input",{attrs:{type:"password","show-password":""},model:{value:e.passwordForm.oldPassword,callback:function(t){e.$set(e.passwordForm,"oldPassword",t)},expression:"passwordForm.oldPassword"}})],1),t("el-form-item",{attrs:{label:"新密码",prop:"newPassword"}},[t("el-input",{attrs:{type:"password","show-password":""},model:{value:e.passwordForm.newPassword,callback:function(t){e.$set(e.passwordForm,"newPassword",t)},expression:"passwordForm.newPassword"}})],1),t("el-form-item",{attrs:{label:"确认密码",prop:"confirmPassword"}},[t("el-input",{attrs:{type:"password","show-password":""},model:{value:e.passwordForm.confirmPassword,callback:function(t){e.$set(e.passwordForm,"confirmPassword",t)},expression:"passwordForm.confirmPassword"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.passwordLoading},on:{click:e.handleChangePassword}},[e._v(" 修改密码 ")]),t("el-button",{on:{click:e.resetPasswordForm}},[e._v("重置")])],1)],1)],1)],1)],1),t("el-card",{staticClass:"permission-card",staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("权限说明")])]),t("div",{staticClass:"permission-content"},[e.isAdmin?t("div",{staticClass:"permission-item"},[t("i",{staticClass:"el-icon-user-solid permission-icon admin"}),t("div",{staticClass:"permission-text"},[t("h4",[e._v("管理员权限")]),t("p",[e._v("您具有系统的最高权限，可以管理所有用户、账户和交易")]),t("ul",[t("li",[e._v("管理系统用户（创建、编辑、删除）")]),t("li",[e._v("查看所有账户信息")]),t("li",[e._v("管理所有交易记录")]),t("li",[e._v("系统配置和维护")])])])]):e.isOfficer?t("div",{staticClass:"permission-item"},[t("i",{staticClass:"el-icon-s-custom permission-icon officer"}),t("div",{staticClass:"permission-text"},[t("h4",[e._v("警员权限")]),t("p",[e._v("您具有执法相关的权限，可以管理账户和处理交易")]),t("ul",[t("li",[e._v("创建和管理自己导入的账户")]),t("li",[e._v("查询账户余额和交易记录")]),t("li",[e._v("发起和处理交易")]),t("li",[e._v("查看个人相关的操作记录")])])])]):t("div",{staticClass:"permission-item"},[t("i",{staticClass:"el-icon-view permission-icon guest"}),t("div",{staticClass:"permission-text"},[t("h4",[e._v("访客权限")]),t("p",[e._v("您当前是访客身份，权限受限")]),t("ul",[t("li",[e._v("查看个人资料")]),t("li",[e._v("修改个人密码")]),t("li",[e._v("浏览公开信息")])]),t("p",{staticClass:"upgrade-hint"},[e._v("如需更多权限，请联系管理员")])])])])]),e.isOfficer?t("el-card",{staticClass:"stats-card",staticStyle:{"margin-top":"20px"}},[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("操作统计")])]),t("el-row",{attrs:{gutter:20}},[t("el-col",{attrs:{span:8}},[t("div",{staticClass:"stat-item"},[t("div",{staticClass:"stat-number"},[e._v(e._s(e.accountCount))]),t("div",{staticClass:"stat-label"},[e._v("管理账户数")])])]),t("el-col",{attrs:{span:8}},[t("div",{staticClass:"stat-item"},[t("div",{staticClass:"stat-number"},[e._v(e._s(e.transactionCount))]),t("div",{staticClass:"stat-label"},[e._v("处理交易数")])])])],1)],1):e._e()],1)],1)},re=[],ie={name:"Profile",data(){const e=(e,t,s)=>{t!==this.passwordForm.newPassword?s(new Error("两次输入的密码不一致")):s()};return{passwordForm:{oldPassword:"",newPassword:"",confirmPassword:""},passwordRules:{oldPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"新密码长度至少为6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:e,trigger:"blur"}]},passwordLoading:!1,accountCount:0,transactionCount:0}},computed:{...(0,f.L8)(["currentUser","isAdmin","isOfficer","isGuest"]),user(){return this.currentUser||{}}},created(){this.loadUserStats()},methods:{async loadUserStats(){if(this.isOfficer)try{const t=await _.getUserAccounts();200===t.data.code&&(this.accountCount=t.data.data.length);try{const e=await A.getTransactionStats();200===e.data.code&&(this.transactionCount=e.data.data.count||0)}catch(e){console.error("加载交易统计失败:",e),this.transactionCount=0}}catch(e){console.error("加载用户统计失败:",e)}},async handleChangePassword(){this.$refs.passwordForm.validate((async e=>{if(!e)return!1;this.passwordLoading=!0;try{const e=await y.changePassword({oldPassword:this.passwordForm.oldPassword,newPassword:this.passwordForm.newPassword});if(200!==e.data.code)throw new Error(e.data.message||"密码修改失败");this.$message.success("密码修改成功"),this.resetPasswordForm()}catch(t){console.error("修改密码失败:",t);let e="密码修改失败";t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),this.$message.error(e)}finally{this.passwordLoading=!1}}))},resetPasswordForm(){this.passwordForm={oldPassword:"",newPassword:"",confirmPassword:""},this.$refs.passwordForm&&this.$refs.passwordForm.resetFields()},getRoleText(e){const t={admin:"管理员",officer:"警员",guest:"访客"};return t[e]||e},getRoleTagType(e){const t={admin:"danger",officer:"warning",guest:"info"};return t[e]||"info"}}},oe=ie,ne=(0,l.A)(oe,ae,re,!1,null,"5c6fb8c0",null),le=ne.exports;a["default"].use(u.Ay);const ce=[{path:"/",redirect:"/dashboard"},{path:"/login",name:"Login",component:F,meta:{requiresAuth:!1}},{path:"/register",name:"Register",component:P,meta:{requiresAuth:!1}},{path:"/dashboard",name:"Dashboard",component:E,meta:{requiresAuth:!0}},{path:"/users",name:"Users",component:N,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/accounts",name:"Accounts",component:W,meta:{requiresAuth:!0,requiresOfficer:!0}},{path:"/transactions",name:"Transactions",component:se,meta:{requiresAuth:!0,requiresOfficer:!0}},{path:"/profile",name:"Profile",component:le,meta:{requiresAuth:!0}}],de=new u.Ay({mode:"history",base:"",routes:ce});de.beforeEach(((e,t,s)=>{const a=e.matched.some((e=>e.meta.requiresAuth)),r=e.matched.some((e=>e.meta.requiresAdmin)),i=e.matched.some((e=>e.meta.requiresOfficer));a&&!w.getters.isLoggedIn?s("/login"):r&&!w.getters.isAdmin||i&&!w.getters.isOfficer?s("/dashboard"):s()}));var ue=de,me=s(1052),pe=s.n(me);a["default"].config.productionTip=!1,a["default"].use(pe()),a["default"].prototype.$axios=b,new a["default"]({router:ue,store:w,render:e=>e(d)}).$mount("#app")}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={id:a,loaded:!1,exports:{}};return e[a](i,i.exports,s),i.loaded=!0,i.exports}s.m=e,function(){s.amdO={}}(),function(){var e=[];s.O=function(t,a,r,i){if(!a){var o=1/0;for(d=0;d<e.length;d++){a=e[d][0],r=e[d][1],i=e[d][2];for(var n=!0,l=0;l<a.length;l++)(!1&i||o>=i)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(n=!1,i<o&&(o=i));if(n){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[a,r,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,i,o=a[0],n=a[1],l=a[2],c=0;if(o.some((function(t){return 0!==e[t]}))){for(r in n)s.o(n,r)&&(s.m[r]=n[r]);if(l)var d=l(s)}for(t&&t(a);c<o.length;c++)i=o[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(d)},a=self["webpackChunkonline_client_frontend"]=self["webpackChunkonline_client_frontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[215,504],(function(){return s(959)}));a=s.O(a)})();
//# sourceMappingURL=app.76b17940.js.map