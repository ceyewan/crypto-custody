# Web-SE å®‰å…¨èŠ¯ç‰‡ç¦»çº¿äº¤æ˜“å®¢æˆ·ç«¯

ä¸€ä¸ªåŸºäºGoè¯­è¨€çš„ç¦»çº¿äº¤æ˜“å®¢æˆ·ç«¯ï¼Œç»“åˆå®‰å…¨èŠ¯ç‰‡æŠ€æœ¯å®ç°å¤šæ–¹è®¡ç®—ï¼ˆMPCï¼‰å¯†é’¥ç®¡ç†å’Œäº¤æ˜“ç­¾ååŠŸèƒ½ã€‚è¯¥é¡¹ç›®æ—¨åœ¨æä¾›é«˜å®‰å…¨æ€§çš„åŠ å¯†è´§å¸èµ„äº§ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹ç‚¹

- **å¤šæ–¹è®¡ç®—ï¼ˆMPCï¼‰å¯†é’¥ç”Ÿæˆ**ï¼šæ”¯æŒé—¨é™ç­¾åï¼Œå¯é…ç½®é˜ˆå€¼å’Œå‚ä¸æ–¹æ•°é‡
- **äº¤æ˜“ç­¾åéªŒè¯**ï¼šå®‰å…¨è¿›è¡Œäº¤æ˜“æ•°æ®ç­¾å
- **å®‰å…¨èŠ¯ç‰‡é›†æˆ**ï¼šä½¿ç”¨å®‰å…¨èŠ¯ç‰‡å­˜å‚¨æ•æ„Ÿå¯†é’¥ææ–™
- **åŠ å¯†ä¿æŠ¤**ï¼šé‡‡ç”¨AES-GCMåŠ å¯†ç®—æ³•ä¿æŠ¤å¯†é’¥æ•°æ®
- **æ—¥å¿—è®°å½•**ï¼šè¯¦ç»†çš„æ“ä½œæ—¥å¿—å’Œé”™è¯¯è¿½è¸ª
- **RESTful API**ï¼šæä¾›ç»Ÿä¸€çš„HTTPæ¥å£

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- Goè¯­è¨€ (v1.24.0)
- Ginæ¡†æ¶ï¼šWebæœåŠ¡å™¨
- PCSCï¼šæ™ºèƒ½å¡é€šä¿¡
- EthereumåŠ å¯†åº“ï¼šåœ°å€ç”Ÿæˆå’Œç­¾åéªŒè¯
- Zapï¼šé«˜æ€§èƒ½æ—¥å¿—ç³»ç»Ÿ
- Viperï¼šé…ç½®ç®¡ç†

## ğŸ”§ å®‰è£…ä¸éƒ¨ç½²

### å‰ç½®è¦æ±‚

- Go 1.24.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- PCSCå…¼å®¹çš„æ™ºèƒ½å¡è¯»å¡å™¨
- æ”¯æŒçš„å®‰å…¨èŠ¯ç‰‡

### è·å–ä»£ç 

```bash
git clone [repository-url]
cd web-se
```

### å®‰è£…ä¾èµ–

```bash
go mod download
```

### ç¼–è¯‘é¡¹ç›®

```bash
go build -o bin/web-se main.go
```

### é…ç½®æ–‡ä»¶

é¡¹ç›®æ ¹ç›®å½•æˆ–`config`ç›®å½•ä¸‹åˆ›å»º`config.yaml`æ–‡ä»¶ï¼š

```yaml
# åŸºæœ¬é…ç½®
debug: true
port: "8080"
temp_dir: "./temp"
bin_dir: "./bin"
keygen_bin: "gg20_keygen"
signing_bin: "gg20_signing"
card_reader_name: ""  # ç•™ç©ºå°†è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨è¯»å¡å™¨
manager_addr: "http://127.0.0.1:8000"

# æ—¥å¿—é…ç½®
log_dir: "./logs"
log_file: "web-se.log"
log_max_size: 10       # å•ä¸ªæ—¥å¿—æ–‡ä»¶æœ€å¤§å¤§å°(MB)
log_max_backups: 10    # ä¿ç•™çš„æ—§æ—¥å¿—æ–‡ä»¶æ•°é‡
log_max_age: 30        # æ—¥å¿—æ–‡ä»¶ä¿ç•™å¤©æ•°
log_compress: true     # æ˜¯å¦å‹ç¼©æ—§æ—¥å¿—
```

### è¿è¡ŒæœåŠ¡

```bash
# ç›´æ¥è¿è¡Œ
./bin/web-se

# æˆ–ä½¿ç”¨Airè¿›è¡Œå¼€å‘ï¼ˆçƒ­é‡è½½ï¼‰
air
```

## ğŸ“š APIæ¥å£

### 1. å¯†é’¥ç”Ÿæˆ

ç”Ÿæˆæ–°çš„MPCå¯†é’¥å¹¶å­˜å‚¨åˆ°å®‰å…¨èŠ¯ç‰‡ä¸­ã€‚

- **URL**: `/api/v1/mpc/keygen`
- **æ–¹æ³•**: `POST`
- **è¯·æ±‚ä½“**:

```json
{
  "threshold": 2,
  "parties": 3,
  "index": 1,
  "filename": "key1.json",
  "username": "user1"
}
```

- **å“åº”**:

```json
{
  "success": true,
  "userName": "user1",
  "address": "0x123abc...",
  "encryptedKey": "base64ç¼–ç çš„åŠ å¯†å¯†é’¥æ•°æ®"
}
```

### 2. æ¶ˆæ¯ç­¾å

ä½¿ç”¨MPCå¯†é’¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åã€‚

- **URL**: `/api/v1/mpc/sign`
- **æ–¹æ³•**: `POST`
- **è¯·æ±‚ä½“**:

```json
{
  "parties": "1,2,3",
  "data": "0x1234abcd...",
  "filename": "signature1.json",
  "encryptedKey": "base64ç¼–ç çš„åŠ å¯†å¯†é’¥",
  "userName": "user1",
  "address": "0x123abc...",
  "signature": "base64ç¼–ç çš„å®‰å…¨èŠ¯ç‰‡ç­¾å"
}
```

- **å“åº”**:

```json
{
  "success": true,
  "signature": "0x9876fedc..."
}
```

### 3. è·å–CPLCä¿¡æ¯

è·å–å®‰å…¨èŠ¯ç‰‡çš„CPLCï¼ˆCard Production Life Cycleï¼‰ä¿¡æ¯ã€‚

- **URL**: `/api/v1/mpc/cplc`
- **æ–¹æ³•**: `GET`
- **å“åº”**:

```json
{
  "success": true,
  "cpic": "base64ç¼–ç çš„CPLCæ•°æ®"
}
```

### 4. åˆ é™¤å¯†é’¥

ä»å®‰å…¨èŠ¯ç‰‡ä¸­åˆ é™¤æŒ‡å®šå¯†é’¥ã€‚

- **URL**: `/api/v1/mpc/delete`
- **æ–¹æ³•**: `POST`
- **è¯·æ±‚ä½“**:

```json
{
  "username": "user1",
  "address": "0x123abc...",
  "signature": "base64ç¼–ç çš„å®‰å…¨èŠ¯ç‰‡ç­¾å"
}
```

- **å“åº”**:

```json
{
  "success": true,
  "address": "0x123abc..."
}
```

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
web-se/
â”œâ”€â”€ main.go          # ç¨‹åºå…¥å£
â”œâ”€â”€ config/          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ config.go
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ controllers/     # APIæ§åˆ¶å™¨
â”‚   â””â”€â”€ mpc.go
â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ mpc.go
â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ mpc.go
â”‚   â””â”€â”€ security.go
â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ crypto.go
â”‚   â”œâ”€â”€ file.go
â”‚   â””â”€â”€ command.go
â”œâ”€â”€ seclient/        # å®‰å…¨èŠ¯ç‰‡å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ cardreader.go
â”‚   â”œâ”€â”€ commands.go
â”‚   â”œâ”€â”€ constants.go
â”‚   â””â”€â”€ utils.go
â”œâ”€â”€ clog/            # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ bin/             # å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ logs/            # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ temp/            # ä¸´æ—¶æ–‡ä»¶
```

## ğŸ“ æ—¥å¿—ç³»ç»Ÿ

é¡¹ç›®ä½¿ç”¨zapæ—¥å¿—åº“ï¼Œç»“åˆlumberjackè¿›è¡Œæ—¥å¿—åˆ†å‰²å’Œç®¡ç†ã€‚æ—¥å¿—åˆ†ä¸ºDEBUGã€INFOã€WARNã€ERRORã€FATALäº”ä¸ªçº§åˆ«ã€‚

æ—¥å¿—è¾“å‡ºç¤ºä¾‹ï¼š
```
{"level":"INFO","ts":"2023-07-01T12:34:56.789Z","caller":"main.go:42","msg":"ç³»ç»Ÿå¯åŠ¨"}
{"level":"INFO","ts":"2023-07-01T12:34:56.790Z","caller":"main.go:43","msg":"é…ç½®åŠ è½½æˆåŠŸ","port":"8080","debug":true,"log_file":"web-se.log","log_dir":"./logs"}
```

## âš™ï¸ å¼€å‘ä¸è°ƒè¯•

### ä½¿ç”¨Airè¿›è¡Œçƒ­é‡è½½

é¡¹ç›®åŒ…å«`.air.toml`é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒä½¿ç”¨Airå·¥å…·è¿›è¡Œå¼€å‘æ—¶çš„çƒ­é‡è½½ã€‚

```bash
# å®‰è£…Air (å¦‚æœå°šæœªå®‰è£…)
go install github.com/cosmtrek/air@latest

# å¯åŠ¨å¼€å‘æ¨¡å¼
air
```

### è°ƒè¯•æ¨¡å¼

åœ¨`config.yaml`ä¸­è®¾ç½®`debug: true`å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œä¼šè¾“å‡ºæ›´è¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼ŒåŒ…æ‹¬å®‰å…¨èŠ¯ç‰‡é€šä¿¡æ•°æ®ã€‚

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. ç¡®ä¿é…ç½®æ–‡ä»¶ä¸­çš„æ•æ„Ÿä¿¡æ¯å¾—åˆ°å¦¥å–„ä¿æŠ¤
2. ç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­è°ƒè¯•æ¨¡å¼
3. å®šæœŸå¤‡ä»½é…ç½®å’Œæ—¥å¿—
4. ä½¿ç”¨å®‰å…¨çš„ç½‘ç»œç¯å¢ƒéƒ¨ç½²æœåŠ¡

## ğŸ“„ è®¸å¯è¯

[è®¸å¯è¯ä¿¡æ¯]

## ğŸ“§ è”ç³»æ–¹å¼

[è”ç³»æ–¹å¼ä¿¡æ¯]
