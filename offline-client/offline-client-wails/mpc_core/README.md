# MPC Core Module

## 概述

`mpc_core` 是 `offline-client-wails` 项目的核心后端模块，封装了所有与多方计算（MPC）和硬件安全芯片交互相关的业务逻辑。它的设计目标是与上层的 Wails 桌面应用框架解耦，使其成为一个独立的、可重用的 Go 模块。

该模块负责处理以下核心功能：

*   **MPC 密钥生成与签名**：通过调用外部 `gg20` 二进制工具执行阈值签名方案（TSS）的密钥生成和签名操作。
*   **硬件安全芯片交互**：管理与硬件安全芯片的连接，并处理敏感数据（如加密密钥）的存储和读取。
*   **配置管理**：加载和管理模块所需的配置。
*   **安全日志**：提供结构化的日志记录功能。

## 模块结构

`mpc_core` 包含以下主要子包：

*   `clog`: 提供结构化的日志记录功能。
*   `config`: 负责加载和解析 `config.yaml` 配置文件。
*   `controllers`: (在此项目中未被充分利用，但设计上用于处理更复杂的业务流程编排)。
*   `middleware`: 提供中间件功能，如错误处理和日志记录。
*   `models`: 定义核心业务逻辑中使用的数据结构。
*   `seclient`: 封装了与硬件安全芯片进行底层通信（APDU 命令）的逻辑。
*   `services`: 核心业务逻辑层，包含 `MPCService` 和 `SecurityService`。
*   `utils`: 提供各种辅助功能，如加密/解密、数据压缩、文件操作以及执行外部命令等。

## 设计理念

*   **分层架构**：模块内部遵循清晰的分层设计。`WailsServices` (位于项目根目录) 作为适配层，将外部请求路由到 `services` 层。`services` 层负责编排业务逻辑，并调用 `utils` 和 `seclient` 来执行具体任务。
*   **依赖注入**：`MPCService` 和 `SecurityService` 在创建时通过构造函数注入其依赖（如配置对象和其它服务），这提高了代码的可测试性和可维护性。
*   **自包含的二进制文件**：通过 Go 的 `embed` 功能，将所有平台（macOS, Windows, Linux）的 `gg20` 二进制文件直接嵌入到最终的可执行文件中。代码会在运行时根据当前操作系统和架构动态选择并执行正确的二进制文件，从而消除了对外部文件的依赖，简化了分发。

更详细的开发者指南，特别是关于请求如何从前端传递到硬件层的完整生命周期，请参阅 `DEVELOPMENT.md`。