(function(e){function t(t){for(var r,i,a=t[0],c=t[1],l=t[2],d=0,g=[];d<a.length;d++)i=a[d],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&g.push(n[i][0]),n[i]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(g.length)g.shift()();return o.push.apply(o,l||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],r=!0,a=1;a<s.length;a++){var c=s[a];0!==n[c]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=s[0]))}return e}var r={},n={app:0},o=[];function i(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=r,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var l=0;l<a.length;l++)t(a[l]);var u=c;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"154f":function(e,t,s){"use strict";s("9ddf")},"1a7b":function(e,t,s){},"1f22":function(e,t,s){},2651:function(e,t,s){},"3da7":function(e,t,s){"use strict";s("85e3")},4360:function(e,t,s){"use strict";s("14d9");var r=s("2b0e"),n=s("2f62");r["default"].use(n["a"]),t["a"]=new n["a"].Store({state:{token:localStorage.getItem("token")||"",user:JSON.parse(localStorage.getItem("user"))||null,wsConnected:!1,wsClient:null,notifications:[],currentSession:null,wsConnecting:!1,wsReconnectTimer:null,wsReconnectAttempts:0,wsLastError:null,wsConnectionLostTime:null},getters:{isLoggedIn:e=>!!e.token,currentUser:e=>e.user,userRole:e=>e.user?e.user.role:"",isAdmin:e=>e.user&&"admin"===e.user.role,isCoordinator:e=>e.user&&"coordinator"===e.user.role,isParticipant:e=>e.user&&"participant"===e.user.role,wsConnected:e=>e.wsConnected,notifications:e=>e.notifications,currentSession:e=>e.currentSession},mutations:{setToken(e,t){e.token=t,localStorage.setItem("token",t)},setUser(e,t){e.user=t,localStorage.setItem("user",JSON.stringify(t))},clearToken(e){e.token="",e.user=null,localStorage.removeItem("token"),localStorage.removeItem("user")},setWsConnected(e,t){e.wsConnected=t},setWsClient(e,t){e.wsClient=t},addNotification(e,t){e.notifications.push(t)},clearNotifications(e){e.notifications=[]},setCurrentSession(e,t){e.currentSession=t},setWsConnecting(e,t){e.wsConnecting=t},setWsReconnectTimer(e,t){e.wsReconnectTimer=t},setWsReconnectAttempts(e,t){e.wsReconnectAttempts=t},incrementWsReconnectAttempts(e){e.wsReconnectAttempts++},setWsLastError(e,t){e.wsLastError=t},setWsConnectionLostTime(e,t){e.wsConnectionLostTime=t}},actions:{login({commit:e},t){const s=t.token&&t.token.startsWith("Bearer ")?t.token.substring(7):t.token;e("setToken",s),e("setUser",t.user)},logout({commit:e,state:t}){t.wsClient&&(t.wsClient.close(1e3,"用户登出"),e("setWsClient",null),e("setWsConnected",!1)),e("setWsReconnectAttempts",0),e("setWsConnecting",!1),e("clearToken")},connectWebSocket({commit:e,state:t,dispatch:s}){if(t.wsConnected||t.wsConnecting)console.log("WebSocket已连接或正在连接中，跳过连接请求");else{if(e("setWsConnecting",!0),t.wsClient)try{t.wsClient.readyState!==WebSocket.OPEN&&t.wsClient.readyState!==WebSocket.CONNECTING||t.wsClient.close(1e3,"主动关闭以重新连接")}catch(r){console.error("关闭WebSocket连接出错:",r)}t.wsReconnectTimer&&(clearTimeout(t.wsReconnectTimer),e("setWsReconnectTimer",null));try{console.log("正在创建新的WebSocket连接...");const r=new WebSocket("ws://localhost:8081/ws"),n=setTimeout(()=>{if(r.readyState!==WebSocket.OPEN&&(console.error("WebSocket连接超时"),r.close(3e3,"连接超时"),e("setWsConnecting",!1),e("setWsLastError","连接超时"),t.token&&t.user)){const r=t.wsReconnectAttempts,n=Math.min(1e3*Math.pow(1.5,r),3e4);console.log(`连接超时，将在 ${n/1e3} 秒后重新连接...`);const o=setTimeout(()=>{e("incrementWsReconnectAttempts"),s("connectWebSocket")},n);e("setWsReconnectTimer",o)}},1e4);r.onopen=()=>{if(clearTimeout(n),console.log("WebSocket连接已建立"),e("setWsConnected",!0),e("setWsConnecting",!1),e("setWsReconnectAttempts",0),e("setWsLastError",null),t.user){const e=t.token&&t.token.startsWith("Bearer ")?t.token.substring(7):t.token;r.send(JSON.stringify({type:"register",username:t.user.username,role:t.user.role,token:e}))}},r.onclose=r=>{clearTimeout(n);const o=t.wsConnected;console.log("WebSocket连接已关闭",r.code,r.reason),e("setWsConnected",!1),e("setWsConnecting",!1),o&&e("setWsConnectionLostTime",Date.now());const i=1e3===r.code&&(r.reason.includes("用户登出")||r.reason.includes("主动关闭"));if(!i&&t.token&&t.user){const n=t.wsReconnectAttempts,o=Math.min(1e3*Math.pow(1.5,n),3e4);console.log(`WebSocket连接非正常关闭，将在 ${o/1e3} 秒后尝试第 ${n+1} 次重连...`),e("setWsLastError",`连接关闭: 代码 ${r.code}, 原因: ${r.reason||"未知"}`);const i=setTimeout(()=>{e("incrementWsReconnectAttempts"),s("connectWebSocket")},o);e("setWsReconnectTimer",i)}},r.onerror=t=>{console.error("WebSocket连接错误:",t),e("setWsLastError","连接错误")},e("setWsClient",r)}catch(r){if(console.error("创建WebSocket连接失败:",r),e("setWsConnecting",!1),e("setWsLastError","连接创建失败: "+(r.message||"未知错误")),t.token&&t.user){const r=t.wsReconnectAttempts,n=Math.min(1e3*Math.pow(1.5,r),3e4);console.log(`创建连接失败，将在 ${n/1e3} 秒后重新尝试...`);const o=setTimeout(()=>{e("incrementWsReconnectAttempts"),s("connectWebSocket")},n);e("setWsReconnectTimer",o)}}}},resetWebSocketConnection({commit:e,dispatch:t,state:s}){if(console.log("重置WebSocket连接"),s.wsClient){try{s.wsClient.readyState!==WebSocket.OPEN&&s.wsClient.readyState!==WebSocket.CONNECTING||s.wsClient.close(1e3,"重置连接")}catch(r){console.error("关闭WebSocket连接出错:",r)}e("setWsClient",null)}s.wsReconnectTimer&&(clearTimeout(s.wsReconnectTimer),e("setWsReconnectTimer",null)),e("setWsConnected",!1),e("setWsConnecting",!1),e("setWsReconnectAttempts",0),s.token&&s.user&&setTimeout(()=>{t("connectWebSocket")},1e3)},checkWebSocketHealth({dispatch:e,state:t}){if(!t.user||!t.token)return!1;const s=t.wsClient;return!(!s||s.readyState!==WebSocket.OPEN)||(console.warn("WebSocket连接不正常，尝试重置..."),e("resetWebSocketConnection"),!1)}}})},"457f":function(e,t,s){"use strict";s.r(t),s.d(t,"WS_MESSAGE_TYPES",(function(){return a})),s.d(t,"initWebSocketService",(function(){return l})),s.d(t,"resetWebSocketService",(function(){return u})),s.d(t,"sendWSMessage",(function(){return d}));s("d9e2");var r=s("4360"),n=s("7424"),o=s("5c96");let i=!1;const a={REGISTER:"register",REGISTER_COMPLETE:"register_complete",KEYGEN_REQUEST:"keygen_request",KEYGEN_INVITE:"keygen_invite",KEYGEN_RESPONSE:"keygen_response",KEYGEN_PARAMS:"keygen_params",KEYGEN_RESULT:"keygen_result",KEYGEN_COMPLETE:"keygen_complete",SIGN_REQUEST:"sign_request",SIGN_INVITE:"sign_invite",SIGN_RESPONSE:"sign_response",SIGN_PARAMS:"sign_params",SIGN_RESULT:"sign_result",SIGN_COMPLETE:"sign_complete",ERROR:"error"};let c={connected:!1,connecting:!1,reconnectAttempts:0};function l(){const e=r["a"].state.wsClient;return e?i&&e._messageHandlerInitialized?(console.log("WebSocket消息处理已初始化，跳过"),!0):(console.log("初始化WebSocket消息处理"),e.onmessage=async e=>{try{let n;try{n=JSON.parse(e.data),console.log("收到WebSocket消息:",n)}catch(t){if(console.error("WebSocket消息解析失败:",t),console.error("收到的原始消息数据:",e.data),"string"===typeof e.data){const t=e.data.indexOf("{");if(t>=0){let r=0,o=-1;for(let s=t;s<e.data.length;s++)if("{"===e.data[s])r++;else if("}"===e.data[s]&&(r--,0===r)){o=s+1;break}if(o>0){const r=e.data.substring(t,o);try{n=JSON.parse(r),console.log("从损坏的消息中恢复JSON成功:",n)}catch(s){return void console.error("恢复JSON失败:",s)}}}}if(!n)return}switch(n.type){case a.REGISTER_COMPLETE:g(n);break;case a.KEYGEN_INVITE:console.log("收到密钥生成邀请:",n),o["Message"].info(`收到来自 ${n.coordinator} 的密钥生成邀请，请在通知页面处理`);break;case a.KEYGEN_PARAMS:await m(n);break;case a.KEYGEN_COMPLETE:h(n);break;case a.SIGN_INVITE:console.log("收到签名邀请:",n),o["Message"].info(`收到签名邀请，地址: ${n.address}，请在通知页面处理`);break;case a.SIGN_PARAMS:await p(n);break;case a.SIGN_COMPLETE:f(n);break;case a.ERROR:k(n);break;default:console.warn("未处理的WebSocket消息类型:",n.type)}r["a"].commit("addNotification",{type:n.type,content:n,timestamp:new Date,responded:!1})}catch(n){console.error("处理WebSocket消息出错:",n)}},e._messageHandlerInitialized=!0,i=!0,!0):(console.error("WebSocket客户端未初始化"),!1)}function u(){i=!1,c={connected:!1,connecting:!1,reconnectAttempts:0}}function d(e){const t=r["a"].state.wsClient;if(!t||t.readyState!==WebSocket.OPEN)return console.error("WebSocket未连接"),!1;try{return t.send(JSON.stringify(e)),!0}catch(s){return console.error("发送WebSocket消息出错:",s),!1}}function g(e){e.success?(r["a"].commit("setWsConnected",!0),c.connected=!0,c.reconnectAttempts=0,console.log("WebSocket注册成功"),o["Message"].success("WebSocket连接成功")):(console.error("WebSocket注册失败:",e.message),o["Message"].error("WebSocket注册失败: "+e.message))}async function m(e){try{const s=r["a"].state.user.username,i=await n["b"].keyGen({threshold:e.threshold,parties:e.total_parts,index:e.part_index,filename:e.filename,username:s});if(!i.data.success)throw new Error("MPC服务密钥生成失败");{let s="";try{const e=await n["c"].getCPIC();s=e.data.cpic}catch(t){console.error("获取CPIC失败:",t)}d({type:a.KEYGEN_RESULT,session_key:e.session_key,part_index:e.part_index,address:i.data.address,cpic:s,encrypted_shard:i.data.encryptedKey,success:!0,message:"密钥生成成功"}),o["Message"].success("密钥生成成功")}}catch(s){console.error("密钥生成失败:",s),d({type:a.KEYGEN_RESULT,session_key:e.session_key,part_index:e.part_index,address:"",cpic:"",encrypted_shard:"",success:!1,message:"密钥生成失败: "+s.message}),o["Message"].error("密钥生成失败: "+s.message)}}function h(e){e.success?o["MessageBox"].alert("密钥生成成功! 地址: "+e.address,"密钥生成完成",{type:"success"}):o["MessageBox"].alert("密钥生成失败: "+e.message,"密钥生成失败",{type:"error"})}async function p(e){try{const t=await n["b"].sign({parties:e.parties,data:e.data,filename:e.filename,encryptedKey:e.encrypted_shard,userName:r["a"].state.user.username,address:e.address,signature:e.signature});if(!t.data.success)throw new Error("MPC服务签名失败");d({type:a.SIGN_RESULT,session_key:e.session_key,part_index:e.part_index,success:!0,signature:t.data.signature,message:"签名成功"}),o["Message"].success("签名成功")}catch(t){console.error("签名失败:",t),d({type:a.SIGN_RESULT,session_key:e.session_key,part_index:e.part_index,success:!1,signature:"",message:"签名失败: "+t.message}),o["Message"].error("签名失败: "+t.message)}}function f(e){e.success?o["MessageBox"].alert("签名成功! 签名结果: "+e.signature,"签名完成",{type:"success"}):o["MessageBox"].alert("签名失败: "+e.message,"签名失败",{type:"error"})}function k(e){console.error("收到错误消息:",e),o["Message"].error("错误: "+e.message)}},"56d7":function(e,t,s){"use strict";s.r(t);s("14d9");var r=s("2b0e"),n=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[e.isLoggedIn?t("ws-status-indicator"):e._e(),t("router-view")],1)},o=[],i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"ws-status-indicator",class:e.statusClass,attrs:{title:e.statusText},on:{click:e.toggleDisplayText}},[t("i",{staticClass:"el-icon-connection"}),e.displayText?t("span",[e._v(e._s(e.statusText))]):e._e()])},a=[],c={name:"WsStatusIndicator",data(){return{displayText:!1,checkInterval:null,tokenWarning:!1}},computed:{isConnected(){return this.$store.state.wsConnected},isConnecting(){return this.$store.state.wsConnecting},lastError(){return this.$store.state.wsLastError},token(){return this.$store.state.token},statusClass(){return this.tokenWarning?"warning":this.isConnected?"connected":this.isConnecting?"connecting":"disconnected"},statusText(){return this.tokenWarning?"Token格式可能有问题":this.isConnected?"连接正常":this.isConnecting?"正在连接...":this.lastError?"连接断开: "+this.lastError:"连接断开"}},methods:{toggleDisplayText(){this.displayText=!this.displayText,this.isConnected||this.checkAuthStatus()},checkConnectionStatus(){this.$store.dispatch("checkWebSocketHealth")},checkAuthStatus(){const e=localStorage.getItem("token");if(console.log("当前token状态:",{token:e?e.substring(0,10)+"...":null,storeToken:this.token?this.token.substring(0,10)+"...":null,hasToken:!!e,wsConnected:this.isConnected}),e&&e.startsWith("Bearer ")){const t=e.substring(7);localStorage.setItem("token",t),this.$store.commit("setToken",t),console.log("已修复token格式 (移除Bearer前缀):",t.substring(0,10)+"..."),this.tokenWarning=!0}else this.tokenWarning=!1}},mounted(){this.checkAuthStatus(),this.checkInterval=setInterval(()=>{this.checkConnectionStatus(),this.checkAuthStatus()},6e4)},beforeDestroy(){this.checkInterval&&clearInterval(this.checkInterval)}},l=c,u=(s("3da7"),s("2877")),d=Object(u["a"])(l,i,a,!1,null,"b517988e",null),g=d.exports,m={name:"App",components:{WsStatusIndicator:g},computed:{isLoggedIn(){return this.$store.getters.isLoggedIn}}},h=m,p=(s("f960"),Object(u["a"])(h,n,o,!1,null,null,null)),f=p.exports,k=(s("e9f5"),s("a732"),s("8c4f")),b=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-container"},[t("el-card",{staticClass:"login-card"},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("h2",[e._v("多方门限签名系统")])]),t("el-form",{ref:"loginForm",attrs:{model:e.loginForm,rules:e.rules,"label-width":"0px"}},[t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"用户名"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",placeholder:"密码","show-password":""},model:{value:e.loginForm.password,callback:function(t){e.$set(e.loginForm,"password",t)},expression:"loginForm.password"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.loading},on:{click:e.handleLogin}},[e._v(" 登录 ")])],1),t("el-form-item",[t("div",{staticClass:"register-link"},[t("span",[e._v("没有账号?")]),t("router-link",{attrs:{to:"/register"}},[e._v("立即注册")])],1)])],1)],1)],1)},y=[],v=(s("d9e2"),s("7424")),S={name:"Login",data(){return{loginForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},loading:!1}},methods:{handleLogin(){this.$refs.loginForm.validate(async e=>{if(!e)return!1;this.loading=!0;try{const e=await v["e"].login({username:this.loginForm.username,password:this.loginForm.password});if(!e.data||!e.data.token)throw new Error("服务器响应异常：缺少认证令牌");const t=e.data.token.startsWith("Bearer ")?e.data.token:"Bearer "+e.data.token,s={token:t,user:e.data.user};this.$store.dispatch("login",s),console.log("用户登录成功",s.user.username,s.user.role),this.$store.dispatch("connectWebSocket"),setTimeout(()=>{this.$router.push("/dashboard"),this.$message.success("登录成功")},500)}catch(r){console.error("登录失败:",r);let e="登录失败，请检查用户名和密码";var t,s;if(r.response)e=(null===(t=r.response.data)||void 0===t?void 0:t.error)||(null===(s=r.response.data)||void 0===s?void 0:s.message)||e;else r.message&&(e=r.message);this.$message.error(e)}finally{this.loading=!1}})}}},_=S,w=(s("7381"),Object(u["a"])(_,b,y,!1,null,"0e07ba8c",null)),C=w.exports,E=function(){var e=this,t=e._self._c;return t("div",{staticClass:"register-container"},[t("el-card",{staticClass:"register-card"},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("h2",[e._v("用户注册")])]),t("el-form",{ref:"registerForm",attrs:{model:e.registerForm,rules:e.rules,"label-width":"0px"}},[t("el-form-item",{attrs:{prop:"username"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-user",placeholder:"用户名"},model:{value:e.registerForm.username,callback:function(t){e.$set(e.registerForm,"username",t)},expression:"registerForm.username"}})],1),t("el-form-item",{attrs:{prop:"password"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",placeholder:"密码","show-password":""},model:{value:e.registerForm.password,callback:function(t){e.$set(e.registerForm,"password",t)},expression:"registerForm.password"}})],1),t("el-form-item",{attrs:{prop:"confirmPassword"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-lock",placeholder:"确认密码","show-password":""},model:{value:e.registerForm.confirmPassword,callback:function(t){e.$set(e.registerForm,"confirmPassword",t)},expression:"registerForm.confirmPassword"}})],1),t("el-form-item",{attrs:{prop:"email"}},[t("el-input",{attrs:{"prefix-icon":"el-icon-message",placeholder:"邮箱"},model:{value:e.registerForm.email,callback:function(t){e.$set(e.registerForm,"email",t)},expression:"registerForm.email"}})],1),t("el-form-item",[t("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary",loading:e.loading},on:{click:e.handleRegister}},[e._v(" 注册 ")])],1),t("el-form-item",[t("div",{staticClass:"login-link"},[t("span",[e._v("已有账号?")]),t("router-link",{attrs:{to:"/login"}},[e._v("立即登录")])],1)])],1)],1)],1)},W=[],P={name:"Register",data(){const e=(e,t,s)=>{t!==this.registerForm.password?s(new Error("两次输入的密码不一致")):s()};return{registerForm:{username:"",password:"",confirmPassword:"",email:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度应为3-20个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度至少为6个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认密码",trigger:"blur"},{validator:e,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}]},loading:!1}},methods:{handleRegister(){this.$refs.registerForm.validate(async e=>{if(!e)return!1;this.loading=!0;try{await v["e"].register({username:this.registerForm.username,password:this.registerForm.password,email:this.registerForm.email});this.$message.success("注册成功，请登录"),this.$router.push("/login")}catch(s){var t;console.error("注册失败:",s),this.$message.error((null===(t=s.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.error)||"注册失败，请稍后重试")}finally{this.loading=!1}})}}},x=P,$=(s("58f0"),Object(u["a"])(x,E,W,!1,null,"1acadbea",null)),T=$.exports,F=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dashboard-container"},[t("el-container",[t("el-header",{staticClass:"header"},[t("div",{staticClass:"logo"},[e._v("MPC密钥管理系统")]),t("div",{staticClass:"user-info"},[t("span",[e._v("欢迎, "+e._s(e.user.username)+" ("+e._s(e.roleText)+")")]),t("el-button",{attrs:{type:"text"},on:{click:e.handleLogout}},[e._v("退出登录")])],1)]),t("el-container",[t("el-aside",{attrs:{width:"250px"}},[t("el-menu",{staticClass:"menu",attrs:{"default-active":e.activeMenu,router:"","background-color":"#304156","text-color":"#bfcbd9","active-text-color":"#409EFF"}},[e.isAdmin?t("el-menu-item",{attrs:{index:"/users"}},[t("i",{staticClass:"el-icon-user"}),t("span",[e._v("用户管理")])]):e._e(),e.isAdmin||e.isCoordinator?t("el-menu-item",{attrs:{index:"/keygen"}},[t("i",{staticClass:"el-icon-key"}),t("span",[e._v("密钥生成")])]):e._e(),e.isAdmin||e.isCoordinator?t("el-menu-item",{attrs:{index:"/sign"}},[t("i",{staticClass:"el-icon-edit"}),t("span",[e._v("交易签名")])]):e._e(),t("el-menu-item",{attrs:{index:"/notifications"}},[t("i",{staticClass:"el-icon-bell"}),t("span",[e._v("通知消息")]),e.notifications.length>0?t("el-badge",{staticClass:"item",attrs:{value:e.notifications.length}}):e._e()],1)],1)],1),t("el-main",[t("router-view"),"/dashboard"===e.$route.path?t("div",{staticClass:"welcome-container"},[t("div",{staticClass:"welcome-message"},[t("i",{staticClass:"el-icon-s-home welcome-icon"}),t("h2",[e._v("欢迎使用多方门限签名系统")]),t("p",[e._v("请根据您的角色和需求，使用左侧菜单选择相应功能")]),e.isAdmin?t("div",{staticClass:"feature-box"},[t("h3",[e._v("管理员功能")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/users")}}},[e._v("用户管理")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/keygen")}}},[e._v("密钥生成")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/sign")}}},[e._v("交易签名")])],1):e.isCoordinator?t("div",{staticClass:"feature-box"},[t("h3",[e._v("协调者功能")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/keygen")}}},[e._v("密钥生成")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/sign")}}},[e._v("交易签名")])],1):e.isParticipant?t("div",{staticClass:"feature-box"},[t("h3",[e._v("参与者功能")]),t("p",[e._v("作为参与者，您将收到密钥生成和签名请求的邀请")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.push("/notifications")}}},[e._v("查看通知")])],1):e._e()])]):e._e()],1)],1)],1)],1)},R=[],I=(s("910d"),s("2f62")),N=s("457f"),A={name:"Dashboard",data(){return{activeMenu:this.$route.path,wsCheckInterval:null,wsErrorCount:0,lastWsReset:0,healthCheckInterval:null}},computed:{...Object(I["b"])(["currentUser","isAdmin","isCoordinator","isParticipant","notifications","wsConnected"]),user(){return this.currentUser||{}},roleText(){return this.isAdmin?"管理员":this.isCoordinator?"协调者":this.isParticipant?"参与者":"访客"},pendingInvitations(){return this.notifications.filter(e=>("keygen_invite"===e.type||"sign_invite"===e.type)&&!e.responded)},hasUnhandledNotifications(){return this.pendingInvitations.length>0}},created(){this.ensureWebSocketConnection(),this.wsCheckInterval=setInterval(()=>{this.checkWsConnection()},1e4),this.checkPendingNotifications()},mounted(){this.isParticipant&&(this.notificationCheckInterval=setInterval(()=>{this.checkPendingNotifications()},6e4)),document.addEventListener("visibilitychange",this.handleVisibilityChange),this.healthCheckInterval=setInterval(()=>{this.checkWsConnection()},6e4)},beforeDestroy(){this.wsCheckInterval&&clearInterval(this.wsCheckInterval),this.notificationCheckInterval&&clearInterval(this.notificationCheckInterval),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.healthCheckInterval&&clearInterval(this.healthCheckInterval)},methods:{handleVisibilityChange(){document.hidden||(console.log("页面变为可见，检查WebSocket连接"),this.checkWsConnection())},checkWsConnection(){this.$store.dispatch("checkWebSocketHealth")},resetWsConnection(){Promise.resolve().then(s.bind(null,"457f")).then(({resetWebSocketService:e})=>{e(),this.$store.dispatch("resetWebSocketConnection")})},ensureWebSocketConnection(){this.$store.dispatch("connectWebSocket"),setTimeout(()=>{Object(N["initWebSocketService"])()},1e3)},checkPendingNotifications(){this.hasUnhandledNotifications&&"/notifications"!==this.$route.path&&(this.$notify({title:"未处理的邀请",message:`您有 ${this.pendingInvitations.length} 个未处理的邀请，即将跳转到通知页面`,type:"warning",duration:5e3}),setTimeout(()=>{this.$router.push("/notifications")},3e3))},handleLogout(){this.$store.dispatch("logout"),this.$router.push("/login")}},watch:{"$route.path"(e){this.activeMenu=e},wsConnected(e){e?(console.log("WebSocket已连接"),this.wsErrorCount=0):console.warn("WebSocket连接已断开")},notifications(e){this.hasUnhandledNotifications&&"/notifications"!==this.$route.path&&this.checkPendingNotifications()}}},O=A,M=(s("8b9d"),Object(u["a"])(O,F,R,!1,null,"5e4ec115",null)),L=M.exports,G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"users-container"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("用户管理")])]),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.userList}},[t("el-table-column",{attrs:{prop:"username",label:"用户名",width:"180"}}),t("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"220"}}),t("el-table-column",{attrs:{prop:"role",label:"当前角色",width:"120"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-select",{attrs:{placeholder:"选择角色",size:"small"},model:{value:s.row.newRole,callback:function(t){e.$set(s.row,"newRole",t)},expression:"scope.row.newRole"}},[t("el-option",{attrs:{label:"管理员",value:"admin"}}),t("el-option",{attrs:{label:"协调者",value:"coordinator"}}),t("el-option",{attrs:{label:"参与者",value:"participant"}}),t("el-option",{attrs:{label:"访客",value:"guest"}})],1),t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"small",disabled:s.row.role===s.row.newRole},on:{click:function(t){return e.updateUserRole(s.row)}}},[e._v(" 更新角色 ")])]}}])})],1),0!==e.userList.length||e.loading?e._e():t("div",{staticClass:"empty-state"},[t("p",[e._v("暂无用户数据")]),t("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.fetchUserList}},[e._v("刷新")])],1)],1)],1)},U=[],j=(s("ab43"),{name:"Users",data(){return{userList:[],loading:!1}},created(){this.fetchUserList()},methods:{async fetchUserList(){this.loading=!0;try{const e=await v["e"].getUsers(),t=e.data.users||e.data.data||[];this.userList=t.map(e=>({...e,newRole:e.role})),0===this.userList.length&&this.$message.warning("未找到用户数据")}catch(t){var e;console.error("获取用户列表失败:",t),this.$message.error("获取用户列表失败: "+((null===(e=t.response)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.error)||t.message))}finally{this.loading=!1}},async updateUserRole(e){try{await v["e"].updateUserRole(e.username,e.newRole),this.$message.success(`用户 ${e.username} 角色已更新为 ${e.newRole}`),e.role=e.newRole}catch(t){console.error("更新用户角色失败:",t),this.$message.error("更新用户角色失败")}}}}),q=j,K=(s("154f"),Object(u["a"])(q,G,U,!1,null,"beb5ce7e",null)),Y=K.exports,B=function(){var e=this,t=e._self._c;return t("div",{staticClass:"keygen-container"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("密钥生成")])]),t("el-form",{ref:"keygenForm",attrs:{model:e.keygenForm,rules:e.keygenRules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"门限值",prop:"threshold"}},[t("el-input-number",{attrs:{min:2,max:e.keygenForm.totalParts},on:{change:e.handleThresholdChange},model:{value:e.keygenForm.threshold,callback:function(t){e.$set(e.keygenForm,"threshold",t)},expression:"keygenForm.threshold"}})],1),t("el-form-item",{attrs:{label:"总分片数",prop:"totalParts"}},[t("el-input-number",{attrs:{min:e.keygenForm.threshold,max:10},model:{value:e.keygenForm.totalParts,callback:function(t){e.$set(e.keygenForm,"totalParts",t)},expression:"keygenForm.totalParts"}})],1),t("el-form-item",{attrs:{label:"参与者",prop:"participants"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择参与者"},model:{value:e.keygenForm.participants,callback:function(t){e.$set(e.keygenForm,"participants",t)},expression:"keygenForm.participants"}},e._l(e.availableParticipants,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.keygenLoading},on:{click:e.handleKeyGenSubmit}},[e._v(" 发起密钥生成 ")])],1)],1)],1)],1)},D=[],J={name:"KeyGen",data(){return{keygenForm:{threshold:2,totalParts:3,participants:[]},keygenRules:{threshold:[{required:!0,message:"请输入门限值",trigger:"blur"}],totalParts:[{required:!0,message:"请输入总分片数",trigger:"blur"}],participants:[{required:!0,message:"请选择参与者",trigger:"change"},{validator:this.validateParticipants,trigger:"change"}]},availableParticipants:[],keygenLoading:!1}},created(){this.fetchAvailableParticipants()},methods:{validateParticipants(e,t,s){!t||t.length<this.keygenForm.threshold?s(new Error(`至少需要选择${this.keygenForm.threshold}个参与者`)):s()},handleThresholdChange(e){e>this.keygenForm.totalParts&&(this.keygenForm.totalParts=e)},async fetchAvailableParticipants(){try{const e=await v["a"].getAvailableUsers();this.availableParticipants=e.data.data.filter(e=>"participant"===e.role).map(e=>e.username),this.availableParticipants.length>=this.keygenForm.threshold&&(this.keygenForm.participants=this.availableParticipants.slice(0,this.keygenForm.totalParts))}catch(s){console.error("获取参与者列表失败:",s);let r="获取参与者列表失败";if(s.response&&401===s.response.status)r="认证已过期，请重新登录",setTimeout(()=>{this.$store.dispatch("logout"),this.$router.push("/login")},1e3);else if(s.response){var e,t;r=(null===(e=s.response.data)||void 0===e?void 0:e.error)||(null===(t=s.response.data)||void 0===t?void 0:t.message)||r}this.$message.error(r)}},handleKeyGenSubmit(){this.$refs.keygenForm.validate(async e=>{if(!e)return!1;this.keygenLoading=!0;try{const e=await v["a"].createSession(this.$store.getters.currentUser.username),t=e.data.session_key;this.$store.commit("setCurrentSession",t),Object(N["sendWSMessage"])({type:N["WS_MESSAGE_TYPES"].KEYGEN_REQUEST,session_key:t,threshold:this.keygenForm.threshold,total_parts:this.keygenForm.totalParts,participants:this.keygenForm.participants}),this.$message.success("密钥生成请求已发送"),this.$router.push("/notifications")}catch(t){console.error("发起密钥生成请求失败:",t),this.$message.error("发起密钥生成请求失败")}finally{this.keygenLoading=!1}})}}},z=J,V=(s("929f"),Object(u["a"])(z,B,D,!1,null,"33adc480",null)),H=V.exports,Q=function(){var e=this,t=e._self._c;return t("div",{staticClass:"sign-container"},[t("el-card",[t("div",{attrs:{slot:"header"},slot:"header"},[t("span",[e._v("交易签名")])]),t("el-form",{ref:"signForm",attrs:{model:e.signForm,rules:e.signRules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"账户地址",prop:"address"}},[t("el-input",{model:{value:e.signForm.address,callback:function(t){e.$set(e.signForm,"address",t)},expression:"signForm.address"}}),t("el-button",{staticStyle:{"margin-top":"5px"},attrs:{type:"text"},on:{click:e.fetchSignAvailableParticipants}},[e._v(" 获取可用参与者 ")])],1),t("el-form-item",{attrs:{label:"待签名数据",prop:"data"}},[t("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.signForm.data,callback:function(t){e.$set(e.signForm,"data",t)},expression:"signForm.data"}})],1),t("el-form-item",{attrs:{label:"门限值",prop:"threshold"}},[t("el-input-number",{attrs:{min:2,max:e.signForm.totalParts},on:{change:e.handleSignThresholdChange},model:{value:e.signForm.threshold,callback:function(t){e.$set(e.signForm,"threshold",t)},expression:"signForm.threshold"}})],1),t("el-form-item",{attrs:{label:"总分片数",prop:"totalParts"}},[t("el-input-number",{attrs:{min:e.signForm.threshold,max:10},model:{value:e.signForm.totalParts,callback:function(t){e.$set(e.signForm,"totalParts",t)},expression:"signForm.totalParts"}})],1),t("el-form-item",{attrs:{label:"参与者",prop:"participants"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择参与者"},model:{value:e.signForm.participants,callback:function(t){e.$set(e.signForm,"participants",t)},expression:"signForm.participants"}},e._l(e.signAvailableParticipants,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.signLoading},on:{click:e.handleSignSubmit}},[e._v(" 发起签名请求 ")])],1)],1)],1)],1)},X=[],Z={name:"Sign",data(){return{signForm:{address:"",data:"0x1234abcd5678efgh9012ijkl3456mnop7890qrst",threshold:2,totalParts:3,participants:[]},signRules:{address:[{required:!0,message:"请输入账户地址",trigger:"blur"}],data:[{required:!0,message:"请输入待签名数据",trigger:"blur"}],threshold:[{required:!0,message:"请输入门限值",trigger:"blur"}],totalParts:[{required:!0,message:"请输入总分片数",trigger:"blur"}],participants:[{required:!0,message:"请选择参与者",trigger:"change"},{validator:this.validateSignParticipants,trigger:"change"}]},signAvailableParticipants:[],signLoading:!1}},methods:{validateSignParticipants(e,t,s){!t||t.length<this.signForm.threshold?s(new Error(`至少需要选择${this.signForm.threshold}个参与者`)):s()},handleSignThresholdChange(e){e>this.signForm.totalParts&&(this.signForm.totalParts=e)},async fetchSignAvailableParticipants(){if(this.signForm.address)try{const e=await v["d"].getAvailableUsers(this.signForm.address);this.signAvailableParticipants=e.data.data.map(e=>e.username),this.signAvailableParticipants.length>=this.signForm.threshold&&(this.signForm.participants=this.signAvailableParticipants.slice(0,this.signForm.threshold)),this.$message.success("已获取可用参与者")}catch(e){console.error("获取签名参与者列表失败:",e),this.$message.error("获取签名参与者列表失败")}else this.$message.warning("请先输入账户地址")},handleSignSubmit(){this.$refs.signForm.validate(async e=>{if(!e)return!1;this.signLoading=!0;try{const e=await v["d"].createSession(this.$store.getters.currentUser.username),t=e.data.session_key;this.$store.commit("setCurrentSession",t),Object(N["sendWSMessage"])({type:N["WS_MESSAGE_TYPES"].SIGN_REQUEST,session_key:t,threshold:this.signForm.threshold,total_parts:this.signForm.totalParts,data:this.signForm.data,address:this.signForm.address,participants:this.signForm.participants}),this.$message.success("签名请求已发送"),this.$router.push("/notifications")}catch(t){console.error("发起签名请求失败:",t),this.$message.error("发起签名请求失败")}finally{this.signLoading=!1}})}}},ee=Z,te=(s("d967"),Object(u["a"])(ee,Q,X,!1,null,"39df3038",null)),se=te.exports,re=function(){var e=this,t=e._self._c;return t("div",{staticClass:"notifications-container"},[t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("通知消息")]),t("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:e.clearNotifications}},[e._v(" 清空通知 ")])],1),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.notifications}},[t("el-table-column",{attrs:{prop:"type",label:"消息类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("el-tag",{attrs:{type:e.getTagType(s.row.type)}},[e._v(e._s(e.formatMsgType(s.row.type)))])]}}])}),t("el-table-column",{attrs:{prop:"timestamp",label:"时间",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(new Date(t.row.timestamp).toLocaleString())+" ")]}}])}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(s){return["keygen_invite"===s.row.type?t("div",[t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.handleKeygenInviteAccept(s.row)}}},[e._v(" 接受 ")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.handleKeygenInviteReject(s.row)}}},[e._v(" 拒绝 ")])],1):"sign_invite"===s.row.type?t("div",[t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.handleSignInviteAccept(s.row)}}},[e._v(" 接受 ")]),t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.handleSignInviteReject(s.row)}}},[e._v(" 拒绝 ")])],1):e._e(),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showMessageDetail(s.row)}}},[e._v(" 查看详情 ")])]}}])}),t("el-table-column",{attrs:{label:"状态",width:"120"},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.responded?t("el-tag",{attrs:{type:"success"}},[e._v("已响应")]):e.isInviteMessage(s.row.type)?t("el-tag",{attrs:{type:"warning"}},[e._v("待响应")]):t("el-tag",{attrs:{type:"info"}},[e._v("-")])]}}])})],1),0===e.notifications.length?t("div",{staticClass:"empty-state"},[e._v(" 暂无通知消息 ")]):e._e()],1)],1)},ne=[],oe={name:"Notifications",computed:{...Object(I["b"])(["notifications"])},methods:{clearNotifications(){this.$store.commit("clearNotifications")},showMessageDetail(e){this.$alert(JSON.stringify(e.content,null,2),"消息详情",{closeOnClickModal:!0})},formatMsgType(e){const t={keygen_invite:"密钥生成邀请",keygen_params:"密钥生成参数",keygen_complete:"密钥生成完成",sign_invite:"签名邀请",sign_params:"签名参数",sign_complete:"签名完成",error:"错误"};return t[e]||e},getTagType(e){return e.includes("invite")?"warning":e.includes("complete")?"success":e.includes("error")?"danger":"info"},isInviteMessage(e){return"keygen_invite"===e||"sign_invite"===e},async handleKeygenInviteAccept(e){try{const t=await v["c"].getCPIC(),s=t.data.cpic;Object(N["sendWSMessage"])({type:N["WS_MESSAGE_TYPES"].KEYGEN_RESPONSE,session_key:e.content.session_key,part_index:e.content.part_index,cpic:s,accept:!0,reason:""}),this.markNotificationResponded(e),this.$message.success("已接受密钥生成邀请")}catch(t){console.error("接受密钥生成邀请失败:",t),this.$message.error("接受密钥生成邀请失败: "+t.message)}},async handleKeygenInviteReject(e){try{Object(N["sendWSMessage"])({type:N["WS_MESSAGE_TYPES"].KEYGEN_RESPONSE,session_key:e.content.session_key,part_index:e.content.part_index,cpic:"",accept:!1,reason:"用户拒绝"}),this.markNotificationResponded(e),this.$message.info("已拒绝密钥生成邀请")}catch(t){console.error("拒绝密钥生成邀请失败:",t),this.$message.error("拒绝密钥生成邀请失败: "+t.message)}},async handleSignInviteAccept(e){try{const t=await v["c"].getCPIC(),s=t.data.cpic;Object(N["sendWSMessage"])({type:N["WS_MESSAGE_TYPES"].SIGN_RESPONSE,session_key:e.content.session_key,part_index:e.content.part_index,cpic:s,accept:!0,reason:""}),this.markNotificationResponded(e),this.$message.success("已接受签名邀请")}catch(t){console.error("接受签名邀请失败:",t),this.$message.error("接受签名邀请失败: "+t.message)}},async handleSignInviteReject(e){try{Object(N["sendWSMessage"])({type:N["WS_MESSAGE_TYPES"].SIGN_RESPONSE,session_key:e.content.session_key,part_index:e.content.part_index,cpic:"",accept:!1,reason:"用户拒绝"}),this.markNotificationResponded(e),this.$message.info("已拒绝签名邀请")}catch(t){console.error("拒绝签名邀请失败:",t),this.$message.error("拒绝签名邀请失败: "+t.message)}},markNotificationResponded(e){const t=this.notifications.findIndex(t=>t.timestamp===e.timestamp&&t.type===e.type);-1!==t&&this.$set(this.notifications[t],"responded",!0)}}},ie=oe,ae=(s("fe71"),Object(u["a"])(ie,re,ne,!1,null,"5ecd6a2c",null)),ce=ae.exports,le=s("4360");r["default"].use(k["a"]);const ue=[{path:"/",redirect:"/dashboard"},{path:"/login",name:"Login",component:C,meta:{requiresAuth:!1}},{path:"/register",name:"Register",component:T,meta:{requiresAuth:!1}},{path:"/dashboard",name:"Dashboard",component:L,meta:{requiresAuth:!0}},{path:"/users",name:"Users",component:Y,meta:{requiresAuth:!0,requiresAdmin:!0}},{path:"/keygen",name:"KeyGen",component:H,meta:{requiresAuth:!0,requiresCoordinatorOrAdmin:!0}},{path:"/sign",name:"Sign",component:se,meta:{requiresAuth:!0,requiresCoordinatorOrAdmin:!0}},{path:"/notifications",name:"Notifications",component:ce,meta:{requiresAuth:!0}}],de=new k["a"]({mode:"hash",base:"",routes:ue});de.beforeEach((e,t,s)=>{const r=e.matched.some(e=>e.meta.requiresAuth),n=e.matched.some(e=>e.meta.requiresAdmin),o=e.matched.some(e=>e.meta.requiresCoordinatorOrAdmin);r&&!le["a"].getters.isLoggedIn?s("/login"):n&&!le["a"].getters.isAdmin?s("/dashboard"):!o||le["a"].getters.isCoordinator||le["a"].getters.isAdmin?s():s("/dashboard")});var ge=de,me=s("5c96"),he=s.n(me),pe=(s("0fae"),s("bc3a")),fe=s.n(pe);r["default"].config.productionTip=!1,r["default"].use(he.a),fe.a.defaults.baseURL="http://localhost:8080",r["default"].prototype.$axios=fe.a,fe.a.interceptors.response.use(e=>e,e=>e.response&&401===e.response.status?(le["a"].commit("clearToken"),ge.push("/login"),Promise.reject(e)):Promise.reject(e)),new r["default"]({router:ge,store:le["a"],render:e=>e(f)}).$mount("#app")},"58f0":function(e,t,s){"use strict";s("ec5b")},7381:function(e,t,s){"use strict";s("a0ba")},7424:function(e,t,s){"use strict";s.d(t,"e",(function(){return l})),s.d(t,"a",(function(){return u})),s.d(t,"d",(function(){return d})),s.d(t,"c",(function(){return g})),s.d(t,"b",(function(){return m}));var r=s("bc3a"),n=s.n(r),o=s("4360");const i="http://localhost:8080",a="http://localhost:8088",c=n.a.create({baseURL:i,timeout:1e4});c.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers["Authorization"]=t.startsWith("Bearer ")?t.substring(7):t),e},e=>(console.error("请求拦截错误:",e),Promise.reject(e))),c.interceptors.response.use(e=>e,e=>(e.response?(401===e.response.status&&(console.error("认证失败，请重新登录"),o["a"]&&o["a"].dispatch&&(o["a"].dispatch("logout"),setTimeout(()=>{window.location.href="/#/login"},100))),console.error("API错误:",e.response.status,e.response.data)):e.request?console.error("请求无响应:",e.request):console.error("请求配置错误:",e.message),Promise.reject(e)));const l={register(e){return c.post("/user/register",e)},login(e){return c.post("/user/login",e)},getUsers(){return c.get("/user/admin/users")},updateUserRole(e,t){return c.put(`/user/admin/users/${e}/role`,{role:t})}},u={createSession(e){return c.get("/keygen/create/"+e)},getAvailableUsers(){return c.get("/keygen/users")}},d={createSession(e){return c.get("/sign/create/"+e)},getAvailableUsers(e){return c.get("/sign/users/"+e)}},g={getCPIC(){return n.a.get(a+"/api/v1/mpc/cplc")},createSE(e){return c.post("/se/create",e)}},m={keyGen(e){return n.a.post(a+"/api/v1/mpc/keygen",e)},sign(e){return n.a.post(a+"/api/v1/mpc/sign",e)}}},"7ed3":function(e,t,s){},"85e3":function(e,t,s){},"8b05":function(e,t,s){},"8b9d":function(e,t,s){"use strict";s("2651")},"929f":function(e,t,s){"use strict";s("7ed3")},"9ddf":function(e,t,s){},a0ba:function(e,t,s){},d967:function(e,t,s){"use strict";s("1f22")},ec5b:function(e,t,s){},f960:function(e,t,s){"use strict";s("8b05")},fe71:function(e,t,s){"use strict";s("1a7b")}});
//# sourceMappingURL=app.04fb5b0e.js.map